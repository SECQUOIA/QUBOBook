
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Benchmarking &#8212; QUBOBook</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Benchmarking';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Solving QUBOs with DWAVE Simulated Annealing" href="DWAVE%20Simulated%20Annealing.html" />
    <link rel="prev" title="Quantum Annealing via D-Wave" href="Quantum%20Annealing%20via%20D-Wave.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="QUBOBook - Home"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="QUBOBook - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    QUBOBook
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Introduction%20to%20Mathematical%20Programming.html">Introduction to Mathematical Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="QUBO%20and%20Ising%20Models.html">Quadratic Unconstrained Binary Optimization</a></li>

<li class="toctree-l1"><a class="reference internal" href="Graver%20Augmentation%20Multiseed%20Algorithm.html">Introduction to GAMA</a></li>
<li class="toctree-l1"><a class="reference internal" href="Quantum%20Annealing%20via%20D-Wave.html">Quantum Annealing via D-Wave</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Benchmarking</a></li>
<li class="toctree-l1"><a class="reference internal" href="DWAVE%20Simulated%20Annealing.html">Solving QUBOs with DWAVE Simulated Annealing</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/SECQUOIA/QUBOBook" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/SECQUOIA/QUBOBook/issues/new?title=Issue%20on%20page%20%2FBenchmarking.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/Benchmarking.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Benchmarking</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#about-this-notebook">About this Notebook</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example">Example</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ising-model">Ising model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#problem-statement">Problem statement</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Example</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-2">Example 2</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Problem statement</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p><a name="top" id="top"></a></p>
<div align="center">
    <h1>Benchmarking</h1>
    <a href="https://github.com/bernalde">David E. Bernal Neira</a>
    <br>
    <i>Davidson School of Chemical Engineering, Purdue University</i>
    <br>
    <br>
    <a href="https://github.com/pedromxavier">Pedro Maciel Xavier</a>
    <br>
    <i>Davidson School of Chemical Engineering, Purdue University</i>
    <br>
    <i>Computer Science &amp; Systems Engineering Program, Federal University of Rio de Janeiro</i>
    <br>
    <br>
    <a href="https://github.com/murraybj">Benjamin J. L. Murray</a>
    <br>
    <i>Davidson School of Chemical Engineering, Purdue University</i>
    <br>
    <i>Undergraduate Research Assistant</i>
    <br>
    <br>
    <a href="https://colab.research.google.com/github/SECQUOIA/QUBONotebooks/blob/main/notebooks_py/5-Benchmarking_python.ipynb" target="_parent">
        <img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"/>
    </a>
    <a href="https://secquoia.github.io/">
        <img src="https://img.shields.io/badge/üå≤‚öõÔ∏èüåê-SECQUOIA-blue" alt="SECQUOIA"/>
    </a>
</div><section id="benchmarking">
<h1>Benchmarking<a class="headerlink" href="#benchmarking" title="Link to this heading">#</a></h1>
<section id="about-this-notebook">
<h2>About this Notebook<a class="headerlink" href="#about-this-notebook" title="Link to this heading">#</a></h2>
<p>With the new availability of unconventional hardware, novel algorithms, and increasingly optimized software to address optimization problems; the first question that arises is, which one is better?
We will call the combination of hardware, algorithm, and software within a solution method a solver.
This question is also relevant when evaluating a single solver, given that usually they rely on hyperparameters, for which the quesiton now becomes, which is the best parameter setting for a given solver?
These questions obviously depend on the problem that one is trying to solve. The solution of the problem also depends on the budget of resources that one has available.</p>
<p>In the case that the available resources are relatively ‚Äúunlimited‚Äù and that the problem to solve is known, one could exhaustively try all the parameter settings within a delimited range for that instance and choose which one is the best.
This case is idealistic, in the sense that usually one does not know a-priori which problem is there to solve (and if while testing all the parameters you solve it, what would be the point of identifying the best parameters?), and that there exists limitations in terms of resources, e.g., time, memory, or energy, when trying to address these problems.
A case closer to reality is where you have the chance of solving problems that look similar to the one that you are interested in solving later, either because you have previously generated problems or you have identified a feature that characterizes your problem of interest and can generate random instances, which we will call as a family of instances.
Then, you can use a larger amount of resources to solve that family of problems ‚Äúoff-line‚Äù, meaning that you spend extra resources to address the problems in your family of instances although it is unrelated to the actual application.
Finally, you would like to use the results that you found off-line as a guidance to solve your unknown problem more efficiently.</p>
</section>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Link to this heading">#</a></h2>
<p>For illustration purposes, we will use an example that you are already familiar with, which is an Ising model. As a solver, we will use a simulated annealing code provided by D-Wave Ocean Tools.</p>
</section>
<section id="ising-model">
<h2>Ising model<a class="headerlink" href="#ising-model" title="Link to this heading">#</a></h2>
<p>In order to implement the different Ising Models we will use D-Wave‚Äôs packages <strong><a class="reference external" href="https://github.com/dwavesystems/dimod">dimod</a></strong> and <strong><a class="reference external" href="https://github.com/dwavesystems/dwave-neal">neal</a></strong>, for defining the Ising model and solving it with simulated annealing, respectively.</p>
</section>
<section id="problem-statement">
<h2>Problem statement<a class="headerlink" href="#problem-statement" title="Link to this heading">#</a></h2>
<p>We pose the Ising problem as the following optimization problem:</p>
<div class="math notranslate nohighlight">
\[
\min_{s \in \{ \pm 1 \}^n} H(s) = \min_{s \in \{ \pm 1 \}^n} \sum_{(i, j) \in E(G)} J_{i,j}s_is_j + \sum_{i \in V(G)} h_is_i + \beta
\]</div>
<p>where we optimize over spins <span class="math notranslate nohighlight">\(s \in \{ \pm 1 \}^n\)</span>, on a constrained graph <span class="math notranslate nohighlight">\(G(V,E)\)</span>, where the quadratic coefficients are <span class="math notranslate nohighlight">\(J_{i,j}\)</span> and the linear coefficients are <span class="math notranslate nohighlight">\(h_i\)</span>.
We also include an arbitrary offset of the Ising model <span class="math notranslate nohighlight">\(\beta\)</span>.</p>
</section>
<section id="id1">
<h2>Example<a class="headerlink" href="#id1" title="Link to this heading">#</a></h2>
<p>Suppose we have an Ising model defined from</p>
<div class="math notranslate nohighlight">
\[\begin{split}
h = \begin{bmatrix}
145.0 \\ 122.0 \\ 122.0 \\ 266.0 \\ 266.0 \\ 266.0 \\ 242.5 \\ 266.0 \\ 386.5 \\ 387.0 \\ 386.5
\end{bmatrix},
J = \begin{bmatrix}
0 &amp; 0 &amp; 0 &amp; 24 &amp; 24 &amp; 24 &amp; 24 &amp; 24 &amp; 24 &amp; 24 &amp; 24\\
0 &amp; 0 &amp; 0 &amp; 24 &amp; 0 &amp; 24 &amp; 24 &amp; 24 &amp; 24 &amp; 24 &amp; 24\\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 24 &amp; 0 &amp; 24 &amp; 24 &amp; 24 &amp; 24 &amp; 24\\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 24 &amp; 48 &amp; 24 &amp; 24 &amp; 48 &amp; 48 &amp; 48\\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 24 &amp; 24 &amp; 48 &amp; 48 &amp; 48 &amp; 48\\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 24 &amp; 24 &amp; 48 &amp; 48 &amp; 48\\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 24 &amp; 48 &amp; 48 &amp; 48\\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 48 &amp; 48 &amp; 48\\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 72 &amp; 72\\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 72\\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
\end{bmatrix} \text{ and }
c_I = 1319.5
\end{split}\]</div>
<p>Let‚Äôs solve this problem</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># If using this on Google collab, we need to install the packages</span>
<span class="k">try</span><span class="p">:</span>
  <span class="kn">import</span> <span class="nn">google.colab</span>
  <span class="n">IN_COLAB</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span><span class="p">:</span>
  <span class="n">IN_COLAB</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># Let&#39;s install with dimod and neal</span>
<span class="k">if</span> <span class="n">IN_COLAB</span><span class="p">:</span>
    <span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>-q<span class="w"> </span>pyomo
    <span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>dimod
    <span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>dwave-neal
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import the Pyomo library, which can be installed via pip, conda or from Github https://github.com/Pyomo/pyomo</span>
<span class="kn">import</span> <span class="nn">pyomo.environ</span> <span class="k">as</span> <span class="nn">pyo</span>
<span class="c1"># Import the Dwave packages dimod and neal</span>
<span class="kn">import</span> <span class="nn">dimod</span>
<span class="kn">import</span> <span class="nn">neal</span>
<span class="c1"># Import Matplotlib to generate plots</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="c1"># Import numpy and scipy for certain numerical calculations below</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">ticker</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># These could also be simple lists and numpy matrices</span>
<span class="n">h</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mf">145.0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mf">122.0</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mf">122.0</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mf">266.0</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="mf">266.0</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span> <span class="mf">266.0</span><span class="p">,</span> <span class="mi">6</span><span class="p">:</span> <span class="mf">242.5</span><span class="p">,</span> <span class="mi">7</span><span class="p">:</span> <span class="mf">266.0</span><span class="p">,</span> <span class="mi">8</span><span class="p">:</span> <span class="mf">386.5</span><span class="p">,</span> <span class="mi">9</span><span class="p">:</span> <span class="mf">387.0</span><span class="p">,</span> <span class="mi">10</span><span class="p">:</span> <span class="mf">386.5</span><span class="p">}</span>
<span class="n">J</span> <span class="o">=</span> <span class="p">{(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span> <span class="mf">24.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span> <span class="mf">24.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span> <span class="mf">24.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">):</span> <span class="mf">24.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span> <span class="mf">24.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">):</span> <span class="mf">24.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span> <span class="mf">24.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span> <span class="mf">24.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span> <span class="mf">24.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span> <span class="mf">24.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span> <span class="mf">24.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">):</span> <span class="mf">24.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span> <span class="mf">24.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span> <span class="mf">24.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span> <span class="mf">24.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">):</span> <span class="mf">24.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span> <span class="mf">24.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">):</span> <span class="mf">24.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span> <span class="mf">24.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span> <span class="mf">24.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span> <span class="mf">48.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span> <span class="mf">24.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">):</span> <span class="mf">24.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span> <span class="mf">48.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">):</span> <span class="mf">48.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span> <span class="mf">48.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span> <span class="mf">24.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span> <span class="mf">24.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">):</span> <span class="mf">48.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span> <span class="mf">48.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">):</span> <span class="mf">48.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span> <span class="mf">48.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span> <span class="mf">24.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">):</span> <span class="mf">24.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span> <span class="mf">48.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">):</span> <span class="mf">48.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span> <span class="mf">48.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">):</span> <span class="mf">24.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span> <span class="mf">48.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">):</span> <span class="mf">48.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span> <span class="mf">48.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span> <span class="mf">48.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">):</span> <span class="mf">48.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span> <span class="mf">48.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">):</span> <span class="mf">72.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span> <span class="mf">72.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span> <span class="mf">72.0</span><span class="p">}</span>
<span class="n">cI</span> <span class="o">=</span> <span class="mf">1319.5</span>


<span class="n">model_ising</span> <span class="o">=</span> <span class="n">dimod</span><span class="o">.</span><span class="n">BinaryQuadraticModel</span><span class="o">.</span><span class="n">from_ising</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">cI</span><span class="p">)</span> <span class="c1"># define the model</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nx_graph</span> <span class="o">=</span> <span class="n">model_ising</span><span class="o">.</span><span class="n">to_networkx_graph</span><span class="p">()</span>
<span class="n">edges</span><span class="p">,</span> <span class="n">bias</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">nx</span><span class="o">.</span><span class="n">get_edge_attributes</span><span class="p">(</span><span class="n">nx_graph</span><span class="p">,</span> <span class="s1">&#39;bias&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
<span class="n">bias</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bias</span><span class="p">)</span>
<span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">nx_graph</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">nx</span><span class="o">.</span><span class="n">spring_layout</span><span class="p">(</span><span class="n">nx_graph</span><span class="p">),</span>
        <span class="n">edgelist</span><span class="o">=</span><span class="n">edges</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="n">bias</span><span class="p">,</span> <span class="n">edge_cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_114151/1437022254.py:1: DeprecationWarning: BinaryQuadraticModel.to_networkx_graph() is deprecated since dimod 0.10.0 and will be removed in 0.12.0. Use dimod.to_networkx_graph() instead.
  nx_graph = model_ising.to_networkx_graph()
</pre></div>
</div>
<img alt="_images/52ac469c8efcb9d1530e4fcd142174fd8fde43c3b4b64aad26ca551cae6a946d.png" src="_images/52ac469c8efcb9d1530e4fcd142174fd8fde43c3b4b64aad26ca551cae6a946d.png" />
</div>
</div>
<p>Since the problem is relatively small (11 variables, <span class="math notranslate nohighlight">\(2^{11}=2048\)</span> combinations), we can afford to enumerate all the solutions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">exactSampler</span> <span class="o">=</span> <span class="n">dimod</span><span class="o">.</span><span class="n">reference</span><span class="o">.</span><span class="n">samplers</span><span class="o">.</span><span class="n">ExactSolver</span><span class="p">()</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">exactSamples</span> <span class="o">=</span> <span class="n">exactSampler</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">model_ising</span><span class="p">)</span>
<span class="n">timeEnum</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;runtime: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">timeEnum</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; seconds&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>runtime: 0.0047452449798583984 seconds
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Some useful functions to get plots</span>
<span class="k">def</span> <span class="nf">plot_energy_values</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

    <span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

    <span class="n">energies</span> <span class="o">=</span> <span class="p">[</span><span class="n">datum</span><span class="o">.</span><span class="n">energy</span> <span class="k">for</span> <span class="n">datum</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">data</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">],</span> <span class="n">sorted_by</span><span class="o">=</span><span class="s1">&#39;energy&#39;</span><span class="p">)]</span>

    <span class="k">if</span> <span class="n">results</span><span class="o">.</span><span class="n">vartype</span> <span class="o">==</span> <span class="s1">&#39;Vartype.BINARY&#39;</span><span class="p">:</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">datum</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span>
            <span class="s1">&#39;, &#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">isdigit</span><span class="p">())</span> <span class="k">for</span> <span class="n">datum</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">data</span><span class="p">([</span><span class="s1">&#39;sample&#39;</span><span class="p">],</span> <span class="n">sorted_by</span><span class="o">=</span><span class="kc">None</span><span class="p">)]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;bitstring for solution&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">energies</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;solution&#39;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">energies</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Energy&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">title</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;minimum energy:&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">energies</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">ax</span>


<span class="k">def</span> <span class="nf">plot_samples</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">results</span><span class="o">.</span><span class="n">vartype</span> <span class="o">==</span> <span class="s1">&#39;Vartype.BINARY&#39;</span><span class="p">:</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">datum</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span>
            <span class="s1">&#39;, &#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">isdigit</span><span class="p">())</span> <span class="k">for</span> <span class="n">datum</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">data</span><span class="p">([</span><span class="s1">&#39;sample&#39;</span><span class="p">],</span> <span class="n">sorted_by</span><span class="o">=</span><span class="kc">None</span><span class="p">)]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;bitstring for solution&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">energies</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;solution&#39;</span><span class="p">)</span>

    <span class="n">counts</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>
    <span class="n">total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">counts</span><span class="p">:</span>
        <span class="n">counts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">/=</span> <span class="n">total</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
    <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="n">t</span><span class="o">.</span><span class="n">get_text</span><span class="p">()[:</span><span class="mi">7</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">i</span><span class="o">%</span><span class="k">skip</span> else &quot;&quot; for i,t in enumerate(ax.get_xticklabels())])
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Probabilities&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">title</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;minimum energy:&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">energies</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">ax</span>


<span class="k">def</span> <span class="nf">plot_energy_cfd</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="c1"># skip parameter given to avoid putting all xlabels</span>
    <span class="n">energies</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">data_vectors</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">]</span>
    <span class="n">occurrences</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">data_vectors</span><span class="p">[</span><span class="s1">&#39;num_occurrences&#39;</span><span class="p">]</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">energies</span><span class="p">)</span>
    <span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">occurrences</span><span class="p">)</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">energy</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">energies</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">energy</span> <span class="ow">in</span> <span class="n">counts</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">counts</span><span class="p">[</span><span class="n">energy</span><span class="p">]</span> <span class="o">+=</span> <span class="n">occurrences</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">counts</span><span class="p">[</span><span class="n">energy</span><span class="p">]</span> <span class="o">=</span> <span class="n">occurrences</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">counts</span><span class="p">:</span>
        <span class="n">counts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">/=</span> <span class="n">total</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
    <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="n">t</span><span class="o">.</span><span class="n">get_text</span><span class="p">()[:</span><span class="mi">7</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">i</span><span class="o">%</span><span class="k">skip</span> else &quot;&quot; for i,t in enumerate(ax.get_xticklabels())])

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Energy&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Probabilities&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">title</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;minimum energy:&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">energies</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">ax</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_energy_values</span><span class="p">(</span><span class="n">exactSamples</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Enumerate all solutions&#39;</span><span class="p">)</span>
<span class="n">plot_energy_cfd</span><span class="p">(</span><span class="n">exactSamples</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Enumerate all solutions&#39;</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>minimum energy: 5.0
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>minimum energy: 5.0
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: title={&#39;center&#39;: &#39;Enumerate all solutions&#39;}, xlabel=&#39;Energy&#39;, ylabel=&#39;Probabilities&#39;&gt;
</pre></div>
</div>
<img alt="_images/5340412cadfe312df44ae680cc9a7868a3cb1230832a7bb9bd5f2fca3ddbfd29.png" src="_images/5340412cadfe312df44ae680cc9a7868a3cb1230832a7bb9bd5f2fca3ddbfd29.png" />
<img alt="_images/7cfc2a9010c087c2bbd93ab9611f3a3238f5fb97821145cb0b691e7903f66c5a.png" src="_images/7cfc2a9010c087c2bbd93ab9611f3a3238f5fb97821145cb0b691e7903f66c5a.png" />
</div>
</div>
<p>We observe that the optimal solution of this problem is <span class="math notranslate nohighlight">\(x_{10} = 1, 0\)</span> otherwise, leading to an objective of <span class="math notranslate nohighlight">\(5\)</span>. Notice that this problem has a degenerate optimal solution given that <span class="math notranslate nohighlight">\(x_8 = 1, 0\)</span> otherwise also leads to the same solution.</p>
<p>Let‚Äôs now solve this problem using Simulated Annealing</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">simAnnSampler</span> <span class="o">=</span> <span class="n">neal</span><span class="o">.</span><span class="n">SimulatedAnnealingSampler</span><span class="p">()</span>
<span class="n">simAnnSamples</span> <span class="o">=</span> <span class="n">simAnnSampler</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">model_ising</span><span class="p">,</span> <span class="n">num_reads</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_energy_values</span><span class="p">(</span><span class="n">simAnnSamples</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Simulated annealing in default parameters&#39;</span><span class="p">)</span>
<span class="n">plot_energy_cfd</span><span class="p">(</span><span class="n">simAnnSamples</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Simulated annealing in default parameters&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>minimum energy: 5.0
minimum energy: 5.0
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: title={&#39;center&#39;: &#39;Simulated annealing in default parameters&#39;}, xlabel=&#39;Energy&#39;, ylabel=&#39;Probabilities&#39;&gt;
</pre></div>
</div>
<img alt="_images/c5979016d53e10229ec348a238851d0fb95126da684c52566661bd905179f5bd.png" src="_images/c5979016d53e10229ec348a238851d0fb95126da684c52566661bd905179f5bd.png" />
<img alt="_images/4e08541716e121f7a6e3dfd1296428659f3509e7ae89587f98234cf2a170ea6f.png" src="_images/4e08541716e121f7a6e3dfd1296428659f3509e7ae89587f98234cf2a170ea6f.png" />
</div>
</div>
<p>We are going to use the default limits of temperature given by the simulating annealing code. These are defined using the minimum and maximum nonzero coefficients in the Ising model. Then the range for beta is defined as</p>
<div class="math notranslate nohighlight">
\[
\beta \in \left[ \frac{\log(2)}{\max \{ \Delta E \} },\frac{\log(100)}{\min \{ \Delta E \} } \right]
\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[
\Delta E = \min_{i} \{h_i \} + \sum_j J_{ij}+J_{ji}
\]</div>
<p>Hot temperature: We want to scale hot_beta so that for the most unlikely qubit flip, we get at least 50% chance of flipping. (This means all other qubits will have &gt; 50% chance of flipping initially). Most unlikely flip is when we go from a very low energy state to a high energy state, thus we calculate hot_beta based on max_delta_energy.</p>
<div class="math notranslate nohighlight">
\[
0.50 = \exp(-\overline{\beta} * \max \{ \Delta E \})
\]</div>
<p>Cold temperature: Towards the end of the annealing schedule, we want to minimize the chance of flipping. Don‚Äôt want to be stuck between small energy tweaks. Hence, set cold_beta so that at minimum energy change, the chance of flipping is set to 1%.</p>
<div class="math notranslate nohighlight">
\[
0.01 = \exp(-\underline{\beta} * \min \{ \Delta E \})
\]</div>
<p>By default, the schedule also follows a geometric series.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">geomspace</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">num</span><span class="o">=</span><span class="n">length</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">hex_to_RGB</span><span class="p">(</span><span class="n">hex_str</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">hex_str</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">)]</span>

<span class="k">def</span> <span class="nf">get_color_gradient</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">1</span>
    <span class="n">c1_rgb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hex_to_RGB</span><span class="p">(</span><span class="n">c1</span><span class="p">))</span><span class="o">/</span><span class="mi">255</span>
    <span class="n">c2_rgb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hex_to_RGB</span><span class="p">(</span><span class="n">c2</span><span class="p">))</span><span class="o">/</span><span class="mi">255</span>
    <span class="n">mix_pcts</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
    <span class="n">rgb_colors</span> <span class="o">=</span> <span class="p">[((</span><span class="mi">1</span><span class="o">-</span><span class="n">mix</span><span class="p">)</span><span class="o">*</span><span class="n">c1_rgb</span> <span class="o">+</span> <span class="p">(</span><span class="n">mix</span><span class="o">*</span><span class="n">c2_rgb</span><span class="p">))</span> <span class="k">for</span> <span class="n">mix</span> <span class="ow">in</span> <span class="n">mix_pcts</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">val</span><span class="o">*</span><span class="mi">255</span><span class="p">)),</span> <span class="s2">&quot;02x&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">item</span><span class="p">])</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">rgb_colors</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">plot_schedule</span><span class="p">(</span><span class="n">beta1</span><span class="p">,</span> <span class="n">beta2</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
    <span class="n">color1</span> <span class="o">=</span> <span class="s2">&quot;#00008b&quot;</span>
    <span class="n">color2</span> <span class="o">=</span> <span class="s2">&quot;#D22B2B&quot;</span>
    <span class="n">sweeps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> <span class="n">num</span><span class="o">=</span><span class="n">length</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span><span class="n">beta1</span><span class="p">,</span> <span class="n">beta2</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">length</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">sweeps</span><span class="p">,</span> 
                <span class="n">y</span><span class="o">=</span><span class="n">beta</span><span class="p">,</span> 
                <span class="n">color</span> <span class="o">=</span> <span class="n">get_color_gradient</span><span class="p">(</span><span class="n">color1</span><span class="p">,</span> <span class="n">color2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">beta</span><span class="p">)),</span> 
                <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Default Geometric temperature schedule&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Sweeps&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$ \beta $ = Inverse temperature&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="n">sweeps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sweeps</span><span class="p">[</span><span class="mi">249</span><span class="p">],</span> <span class="n">sweeps</span><span class="p">[</span><span class="mi">499</span><span class="p">],</span> <span class="n">sweeps</span><span class="p">[</span><span class="mi">749</span><span class="p">],</span> <span class="n">sweeps</span><span class="p">[</span><span class="mi">999</span><span class="p">]],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">250</span><span class="p">,</span><span class="mi">500</span><span class="p">,</span><span class="mi">750</span><span class="p">,</span><span class="mi">1000</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([</span><span class="n">beta1</span><span class="p">,</span> <span class="n">beta2</span><span class="p">],</span> <span class="p">[</span><span class="sa">r</span><span class="s2">&quot;$ \beta_</span><span class="si">{0}</span><span class="s2"> $&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$ \beta_</span><span class="si">{1}</span><span class="s2"> $&quot;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">beta1</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">beta2</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">plot_schedule</span><span class="p">(</span><span class="n">beta1</span><span class="p">,</span> <span class="n">beta2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d57df57c04a5508a3e7c418158ef5e4f91c5bb13952c7ce75b55ab08a7a85c86.png" src="_images/d57df57c04a5508a3e7c418158ef5e4f91c5bb13952c7ce75b55ab08a7a85c86.png" />
</div>
</div>
<p>Now let‚Äôs compute an expected time metric with respect to the number of sweeps in simulated annealing.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="mf">0.99</span>
<span class="c1"># sweeps = list(chain(np.arange(1,10,1),np.arange(10,30,2), np.arange(30,50,5), np.arange(50,100,10) ,np.arange(100,1001,100)))</span>
<span class="n">sweeps</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">chain</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">250</span><span class="p">,</span> <span class="mi">1001</span><span class="p">,</span> <span class="mi">10</span><span class="p">)))</span>
<span class="n">schedules</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;geometric&#39;</span><span class="p">,</span><span class="s1">&#39;linear&#39;</span><span class="p">]</span>
<span class="n">opt_energy</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;tts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span><span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">schedule</span> <span class="ow">in</span> <span class="n">schedules</span><span class="p">:</span>
    <span class="n">probs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">time_to_sol</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">times</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">sweep</span> <span class="ow">in</span> <span class="n">sweeps</span><span class="p">:</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="n">simAnnSampler</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">model_ising</span><span class="p">,</span> <span class="n">num_reads</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">num_sweeps</span><span class="o">=</span><span class="n">sweep</span><span class="p">,</span> <span class="n">beta_schedule_type</span><span class="o">=</span><span class="n">schedule</span><span class="p">)</span>
        <span class="n">time_s</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
        <span class="n">energies</span><span class="o">=</span><span class="n">samples</span><span class="o">.</span><span class="n">data_vectors</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">]</span>
        <span class="n">occurrences</span> <span class="o">=</span> <span class="n">samples</span><span class="o">.</span><span class="n">data_vectors</span><span class="p">[</span><span class="s1">&#39;num_occurrences&#39;</span><span class="p">]</span>
        <span class="n">total_counts</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">occurrences</span><span class="p">)</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">energy</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">energies</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">energy</span> <span class="ow">in</span> <span class="n">counts</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">counts</span><span class="p">[</span><span class="n">energy</span><span class="p">]</span> <span class="o">+=</span> <span class="n">occurrences</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">counts</span><span class="p">[</span><span class="n">energy</span><span class="p">]</span> <span class="o">=</span> <span class="n">occurrences</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">pr</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                 <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">counts</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">key</span> <span class="o">&lt;=</span> <span class="n">opt_energy</span><span class="p">)</span><span class="o">/</span><span class="n">total_counts</span>
        <span class="n">probs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pr</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">time_to_sol</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">time_to_sol</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time_s</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">s</span><span class="p">)</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">pr</span><span class="p">))</span>
        <span class="n">times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time_s</span><span class="p">)</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">][</span><span class="n">schedule</span><span class="p">]</span> <span class="o">=</span> <span class="n">probs</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;tts&#39;</span><span class="p">][</span><span class="n">schedule</span><span class="p">]</span> <span class="o">=</span> <span class="n">time_to_sol</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="n">schedule</span><span class="p">]</span> <span class="o">=</span> <span class="n">times</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Simulated annealing expected runtime of </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
             <span class="s1">&#39; easy Ising N=10 with varying schedule and sweeps&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">schedule</span> <span class="ow">in</span> <span class="n">schedules</span><span class="p">:</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sweeps</span><span class="p">,</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="n">schedule</span><span class="p">],</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">schedule</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="s1">&#39;geometric&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">sweeps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sweeps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
           <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">timeEnum</span><span class="p">,</span> <span class="n">sweeps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sweeps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;enumerate&#39;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Time [s]&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">schedule</span> <span class="ow">in</span> <span class="n">schedules</span><span class="p">:</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sweeps</span><span class="p">,</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">][</span><span class="n">schedule</span><span class="p">],</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">schedule</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">][</span><span class="s1">&#39;geometric&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">sweeps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sweeps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
           <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">sweeps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sweeps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;enumerate&#39;</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Success Probability [%]&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Sweeps&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.25</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7bfa9eee0760&gt;
</pre></div>
</div>
<img alt="_images/fcd26b93065efadc154fcefd04b9718b6aced8c9768ef975e4ea486970763fc0.png" src="_images/fcd26b93065efadc154fcefd04b9718b6aced8c9768ef975e4ea486970763fc0.png" />
</div>
</div>
<p>These plots represent ofter contradictory metrics, on one hand you would like to obtain a large probability of finding a right solution (the deffinition of right comes from what you define as success). On the other hand, the time it takes to solve these cases should be as small as possible.
This is why we are interested in a metric that combines both, and that is why we settle on the Time To Solution (TTS) which is defined as</p>
<div class="math notranslate nohighlight">
\[
TTS = \frac{\log{1-s}}{\log{1-p}}
\]</div>
<p>where s is a success factor, usually takes as <span class="math notranslate nohighlight">\(s = 99\%\)</span>, and <span class="math notranslate nohighlight">\(p\)</span> is the success probability, usually accounted as the observed success probability.</p>
<p>One usually reads this as the time to solution within 99% probability.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig1</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="k">for</span> <span class="n">schedule</span> <span class="ow">in</span> <span class="n">schedules</span><span class="p">:</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">sweeps</span><span class="p">,</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;tts&#39;</span><span class="p">][</span><span class="n">schedule</span><span class="p">],</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">schedule</span><span class="p">)</span>


<span class="c1"># Value for the default solution</span>
<span class="n">ttsDefault</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;tts&#39;</span><span class="p">][</span><span class="s1">&#39;geometric&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">ttsDefault</span><span class="p">,</span> <span class="n">sweeps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sweeps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>


<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Time To Optimal Solution with &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span> <span class="o">+</span><span class="s1">&#39; </span><span class="si">% c</span><span class="s1">hance [s]&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Sweeps&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Simulated annealing expected runtime of </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39; example with varying schedule and sweeps&#39;</span><span class="p">)</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">.45</span><span class="p">,</span> <span class="mf">.3</span><span class="p">,</span> <span class="mf">.4</span><span class="p">,</span> <span class="mf">.4</span><span class="p">])</span>
<span class="k">for</span> <span class="n">schedule</span> <span class="ow">in</span> <span class="n">schedules</span><span class="p">:</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">sweeps</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">],</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;tts&#39;</span><span class="p">][</span><span class="n">schedule</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">],</span><span class="s1">&#39;-s&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;TTS [s]&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Sweeps&#39;</span><span class="p">)</span>


<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.15</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7bfa9edc5fc0&gt;
</pre></div>
</div>
<img alt="_images/b853c6dd160d4ba62f4925b200fb816967d75c3f76c97ee1a06204204cc26241.png" src="_images/b853c6dd160d4ba62f4925b200fb816967d75c3f76c97ee1a06204204cc26241.png" />
</div>
</div>
<p>As you can notice, the default parameters given by D-Wave (number of sweeps = 1000 and a geometric update of <span class="math notranslate nohighlight">\(\beta\)</span>) are not optimal for our tiny example in terms of expected runtime.
This is certainly a function of the problem, for such a small instance having two sweeps are more than enough and more sweeps are an overkill.
This parameters choice might not generalize to any other problem, as seen below.</p>
</section>
<section id="example-2">
<h2>Example 2<a class="headerlink" href="#example-2" title="Link to this heading">#</a></h2>
<p>Let‚Äôs define a larger model, with 100 variables and random weights, to see how this performance changes.</p>
<p>Assume that we are interested at the instance created with random weights <span class="math notranslate nohighlight">\(h_{i}, J_{i, j} \sim U[-1, +1]\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1"># Number of variables</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span> <span class="c1"># Fixing the random seed to get the same result</span>
<span class="n">J</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
<span class="n">J</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">J</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># We only consider upper triangular matrix ignoring the diagonal</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_random</span> <span class="o">=</span> <span class="n">dimod</span><span class="o">.</span><span class="n">BinaryQuadraticModel</span><span class="o">.</span><span class="n">from_ising</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nx_graph</span> <span class="o">=</span> <span class="n">model_random</span><span class="o">.</span><span class="n">to_networkx_graph</span><span class="p">()</span>
<span class="n">edges</span><span class="p">,</span> <span class="n">bias</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">nx</span><span class="o">.</span><span class="n">get_edge_attributes</span><span class="p">(</span><span class="n">nx_graph</span><span class="p">,</span> <span class="s1">&#39;bias&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
<span class="n">bias</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bias</span><span class="p">)</span>
<span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">nx_graph</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">nx</span><span class="o">.</span><span class="n">spring_layout</span><span class="p">(</span><span class="n">nx_graph</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">edgelist</span><span class="o">=</span><span class="n">edges</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="n">bias</span><span class="p">,</span> <span class="n">edge_cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_114151/1579279843.py:1: DeprecationWarning: BinaryQuadraticModel.to_networkx_graph() is deprecated since dimod 0.10.0 and will be removed in 0.12.0. Use dimod.to_networkx_graph() instead.
  nx_graph = model_random.to_networkx_graph()
</pre></div>
</div>
<img alt="_images/24ff4be0e365cc6faee0aed41d89085cd06492e5bee1a5b4229e025686ccac8c.png" src="_images/24ff4be0e365cc6faee0aed41d89085cd06492e5bee1a5b4229e025686ccac8c.png" />
</div>
</div>
<p>For a problem of this size we cannot do a complete enumeration (<span class="math notranslate nohighlight">\(2^{100} \approx 1.2e30\)</span>) but we can randomly sample the distribution of energies to have a baseline for our later comparisons.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">randomSampler</span> <span class="o">=</span> <span class="n">dimod</span><span class="o">.</span><span class="n">RandomSampler</span><span class="p">()</span>
<span class="n">randomSample</span> <span class="o">=</span> <span class="n">randomSampler</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">model_random</span><span class="p">,</span> <span class="n">num_reads</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">energies</span> <span class="o">=</span> <span class="p">[</span><span class="n">datum</span><span class="o">.</span><span class="n">energy</span> <span class="k">for</span> <span class="n">datum</span> <span class="ow">in</span> <span class="n">randomSample</span><span class="o">.</span><span class="n">data</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">],</span> <span class="n">sorted_by</span><span class="o">=</span><span class="s1">&#39;energy&#39;</span><span class="p">)]</span>
<span class="n">random_energy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">energies</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Average random energy:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">random_energy</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Average random energy:-0.2504200813470361
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_energy_values</span><span class="p">(</span><span class="n">randomSample</span><span class="p">,</span>
               <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Random sampling&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>minimum energy: -79.53825499710057
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: title={&#39;center&#39;: &#39;Random sampling&#39;}, xlabel=&#39;solution&#39;, ylabel=&#39;Energy&#39;&gt;
</pre></div>
</div>
<img alt="_images/830a497f8ab9df2c01d5678d38c289ccb6bd95dc8d79aea328cd8b2f5ef055db.png" src="_images/830a497f8ab9df2c01d5678d38c289ccb6bd95dc8d79aea328cd8b2f5ef055db.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">simAnnSamplesDefault</span> <span class="o">=</span> <span class="n">simAnnSampler</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">model_random</span><span class="p">,</span> <span class="n">num_reads</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">timeDefault</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
<span class="n">energies</span> <span class="o">=</span> <span class="p">[</span><span class="n">datum</span><span class="o">.</span><span class="n">energy</span> <span class="k">for</span> <span class="n">datum</span> <span class="ow">in</span> <span class="n">simAnnSamplesDefault</span><span class="o">.</span><span class="n">data</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">],</span> <span class="n">sorted_by</span><span class="o">=</span><span class="s1">&#39;energy&#39;</span><span class="p">)]</span>
<span class="n">min_energy</span> <span class="o">=</span> <span class="n">energies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;minimum energy: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">min_energy</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;runtime: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">timeDefault</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; seconds&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>minimum energy: -236.4258051878277
runtime: 3.1673173904418945 seconds
</pre></div>
</div>
</div>
</div>
</section>
<section id="id2">
<h2>Problem statement<a class="headerlink" href="#id2" title="Link to this heading">#</a></h2>
<p>We pose the Ising problem as the following optimization problem:</p>
<div class="math notranslate nohighlight">
\[
\min_{s \in \{ \pm 1 \}^n} H(s) = \min_{s \in \{ \pm 1 \}^n} \sum_{(i, j) \in E(G)} J_{i,j}s_is_j + \sum_{i \in V(G)} h_is_i + \beta
\]</div>
<p>where we optimize over spins <span class="math notranslate nohighlight">\(s \in \{ \pm 1 \}^n\)</span>, on a constrained graph <span class="math notranslate nohighlight">\(G(V,E)\)</span>, where the quadratic coefficients are <span class="math notranslate nohighlight">\(J_{i,j}\)</span> and the linear coefficients are <span class="math notranslate nohighlight">\(h_i\)</span>.
We also include an arbitrary offset of the Ising model <span class="math notranslate nohighlight">\(\beta\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax_enum</span> <span class="o">=</span> <span class="n">plot_energy_values</span><span class="p">(</span><span class="n">simAnnSamplesDefault</span><span class="p">,</span>
               <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Simulated annealing with default parameters&#39;</span><span class="p">)</span>
<span class="n">ax_enum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="n">min_energy</span><span class="o">*</span><span class="p">(</span><span class="mf">0.99</span><span class="p">)</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">min_energy</span><span class="p">),</span><span class="n">min_energy</span><span class="o">*</span><span class="p">(</span><span class="mf">1.1</span><span class="p">)</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">min_energy</span><span class="p">)])</span>
<span class="n">plot_energy_cfd</span><span class="p">(</span><span class="n">simAnnSamplesDefault</span><span class="p">,</span>
              <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Simulated annealing with default parameters&#39;</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>minimum energy: -236.4258051878277
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>minimum energy: -236.4258051878277
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: title={&#39;center&#39;: &#39;Simulated annealing with default parameters&#39;}, xlabel=&#39;Energy&#39;, ylabel=&#39;Probabilities&#39;&gt;
</pre></div>
</div>
<img alt="_images/e4e8ee96602b02e1e23097ec3fb594e5b307ad561721dafb3d487074f554c41d.png" src="_images/e4e8ee96602b02e1e23097ec3fb594e5b307ad561721dafb3d487074f554c41d.png" />
<img alt="_images/8bb49351d21a11a1dc230e0e1e8ed7cf773cd823d17b7e951b66cc4435d4dfa1.png" src="_images/8bb49351d21a11a1dc230e0e1e8ed7cf773cd823d17b7e951b66cc4435d4dfa1.png" />
</div>
</div>
<p>Notice that the minimum energy coming from the random sampling and the one from the simulated annealing are very different.
Moreover, the distributions that both lead to are extremely different too.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">simAnnSamplesDefault</span><span class="o">.</span><span class="n">info</span><span class="p">)</span>
<span class="n">beta_schedule</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span><span class="o">*</span><span class="n">simAnnSamplesDefault</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;beta_range&#39;</span><span class="p">],</span> <span class="n">num</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">beta_schedule</span><span class="p">,</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Sweeps&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;beta=Inverse temperature&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Default Geometric temperature schedule&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;beta_range&#39;: [0.0061437051318809005, 86238.87552721801], &#39;beta_schedule_type&#39;: &#39;geometric&#39;, &#39;timing&#39;: {&#39;preprocessing_ns&#39;: 20513575, &#39;sampling_ns&#39;: 3146221946, &#39;postprocessing_ns&#39;: 435022}}
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Default Geometric temperature schedule&#39;)
</pre></div>
</div>
<img alt="_images/c981794ca2bc3587a2aa606637e7781921aed50e23aa5d7c8a56e5c0f949693e.png" src="_images/c981794ca2bc3587a2aa606637e7781921aed50e23aa5d7c8a56e5c0f949693e.png" />
</div>
</div>
<p>We can solve this problem using IP such that we have guarantees that it is solved to optimality (this might be a great quiz for future lectures), but in this case let us define the ‚Äúsuccess‚Äù as getting an objective certain percentage of the best found solution in all cases (which we see it might not be even found with the default parameters).
To get a scaled version of this success equivalent for all instances, we will define this success with respect to the metric:</p>
<div class="math notranslate nohighlight">
\[
\frac{found - random}{minimum - random}
\]</div>
<p>Where <span class="math notranslate nohighlight">\(found\)</span> corresponds to the best found solution within our sampling, <span class="math notranslate nohighlight">\(random\)</span> is the mean of the random sampling shown above, and <span class="math notranslate nohighlight">\(minimum\)</span> corresponds to the best found solution to our problem during the exploration. Consider that this minimum might not be the global minimum.
This metric is very informative given that the best performance you can have is 1, being at the minimum, and negative values would correspond to a method that at best behaves worse that the random sampling.
Success now is counted as being within certain treshold of this value of 1.
This new way of measuring each method is very similar to the approximation ratio of approximation algorithms, therefore we will use that terminology from now on.</p>
<p>Before figuring out if we have the right optimal parameters, we want to save some effort by loading previously computed results.
If you do not want to load the results that we are providing, feel free to change the <code class="docutils literal notranslate"><span class="pre">overwrite_pickles</span></code> variable, at the expense that it will take some time (around 10 minutes per instance) to run.
Otherwise, a zip file with precomputed results will be downloaded from github.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">current_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="n">pickle_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_path</span><span class="p">,</span> <span class="s1">&#39;results/&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pickle_path</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Results directory &#39;</span> <span class="o">+</span> <span class="n">pickle_path</span> <span class="o">+</span>
          <span class="s1">&#39; does not exist. We will create it.&#39;</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">pickle_path</span><span class="p">)</span>
    <span class="o">!</span>wget<span class="w"> </span>-O<span class="w"> </span>/content/results/results.zip<span class="w"> </span>-N<span class="w"> </span>-q<span class="w"> </span><span class="s2">&quot;https://github.com/JuliaQUBO/QUBONotebooks/raw/main/notebooks_py/results.zip&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">zipfile</span>
<span class="n">zip_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pickle_path</span><span class="p">,</span> <span class="s1">&#39;results.zip&#39;</span><span class="p">)</span>
<span class="n">overwrite_pickles</span> <span class="o">=</span> <span class="kc">False</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">zip_name</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">zip_name</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_ref</span><span class="p">:</span>
        <span class="n">zip_ref</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">pickle_path</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Results zip file has been extrated to &#39;</span> <span class="o">+</span> <span class="n">pickle_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now either we have the pickled file or not, let us compute the statistics we are looking for.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="mf">0.99</span> <span class="c1"># This is the success probability for the TTS calculation</span>
<span class="n">treshold</span> <span class="o">=</span> <span class="mf">5.0</span> <span class="c1"># This is a percentual treshold of what the minimum energy should be</span>
<span class="n">sweeps</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">chain</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">250</span><span class="p">,</span> <span class="mi">1001</span><span class="p">,</span> <span class="mi">10</span><span class="p">)))</span>
<span class="c1"># schedules = [&#39;geometric&#39;, &#39;linear&#39;]</span>
<span class="n">schedules</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;geometric&#39;</span><span class="p">]</span>
<span class="n">total_reads</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">default_sweeps</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">n_boot</span><span class="o">=</span><span class="mi">1000</span>
<span class="n">ci</span><span class="o">=</span><span class="mi">68</span> <span class="c1"># Confidence interval for bootstrapping</span>
<span class="n">boots</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">default_sweeps</span><span class="p">]</span>
<span class="n">min_energy</span> <span class="o">=</span> <span class="o">-</span><span class="mf">239.5</span>
<span class="n">instance</span> <span class="o">=</span> <span class="mi">42</span>    
<span class="n">results_name</span> <span class="o">=</span> <span class="s2">&quot;results_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.pkl&quot;</span>
<span class="n">results_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pickle_path</span><span class="p">,</span> <span class="n">results_name</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;min_energy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;random_energy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;tts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;ttsci&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span><span class="o">=</span> <span class="p">{}</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;best&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;bestci&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="c1"># If you wan to to use the raw data and process it here</span>
<span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">results_name</span><span class="p">)):</span>
    <span class="c1"># If you want to generate the data or load it here</span>

    <span class="k">for</span> <span class="n">boot</span> <span class="ow">in</span> <span class="n">boots</span><span class="p">:</span>
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">][</span><span class="n">boot</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;tts&#39;</span><span class="p">][</span><span class="n">boot</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;ttsci&#39;</span><span class="p">][</span><span class="n">boot</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;best&#39;</span><span class="p">][</span><span class="n">boot</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;bestci&#39;</span><span class="p">][</span><span class="n">boot</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">schedule</span> <span class="ow">in</span> <span class="n">schedules</span><span class="p">:</span>
        <span class="n">probs</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">boots</span><span class="p">}</span>
        <span class="n">time_to_sol</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">boots</span><span class="p">}</span>
        <span class="n">prob_np</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">boots</span><span class="p">}</span>
        <span class="n">ttscs</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">boots</span><span class="p">}</span>
        <span class="n">times</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">b</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">boots</span><span class="p">}</span>
        <span class="n">bnp</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">boots</span><span class="p">}</span>
        <span class="n">bcs</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">boots</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">sweep</span> <span class="ow">in</span> <span class="n">sweeps</span><span class="p">:</span>
            <span class="c1"># Gather instance names</span>
            <span class="n">pickle_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">schedule</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sweep</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.p&quot;</span>
            <span class="n">pickle_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pickle_path</span><span class="p">,</span> <span class="n">pickle_name</span><span class="p">)</span>
            <span class="c1"># If the instance data exists, load the data</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pickle_name</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overwrite_pickles</span><span class="p">:</span>
                <span class="c1"># print(pickle_name)</span>
                <span class="n">samples</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">pickle_name</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>
                <span class="n">time_s</span> <span class="o">=</span> <span class="n">samples</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;timing&#39;</span><span class="p">]</span>
            <span class="c1"># If it does not exist, generate the data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                <span class="n">samples</span> <span class="o">=</span> <span class="n">simAnnSampler</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">model_random</span><span class="p">,</span> <span class="n">num_reads</span><span class="o">=</span><span class="n">total_reads</span><span class="p">,</span> <span class="n">num_sweeps</span><span class="o">=</span><span class="n">sweep</span><span class="p">,</span> <span class="n">beta_schedule_type</span><span class="o">=</span><span class="n">schedule</span><span class="p">)</span>
                <span class="n">time_s</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
                <span class="n">samples</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;timing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time_s</span>
                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">pickle_name</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">))</span>
            <span class="c1"># Compute statistics</span>
            <span class="n">energies</span><span class="o">=</span><span class="n">samples</span><span class="o">.</span><span class="n">data_vectors</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">]</span>
            <span class="n">occurrences</span> <span class="o">=</span> <span class="n">samples</span><span class="o">.</span><span class="n">data_vectors</span><span class="p">[</span><span class="s1">&#39;num_occurrences&#39;</span><span class="p">]</span>
            <span class="n">total_counts</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">occurrences</span><span class="p">)</span>
            <span class="n">times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time_s</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">energies</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">min_energy</span><span class="p">:</span>
                <span class="n">min_energy</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">energies</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;A better solution of &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">min_energy</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; was found for sweep &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sweep</span><span class="p">))</span>
            <span class="c1"># success = min_energy*(1.0 + treshold/100.0)**np.sign(min_energy)</span>
            <span class="n">success</span> <span class="o">=</span> <span class="n">random_energy</span> <span class="o">-</span> <span class="p">(</span><span class="n">random_energy</span> <span class="o">-</span> <span class="n">min_energy</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">treshold</span><span class="o">/</span><span class="mf">100.0</span><span class="p">)</span>
            
            <span class="c1"># Best of boot samples es computed via n_boot bootstrappings</span>
            <span class="n">boot_dist</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">pr_dist</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">cilo</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">ciup</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">pr</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">pr_cilo</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">pr_ciup</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">boot</span> <span class="ow">in</span> <span class="n">boots</span><span class="p">:</span>
                <span class="n">boot_dist</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">pr_dist</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n_boot</span><span class="p">)):</span>
                    <span class="n">resampler</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">total_reads</span><span class="p">,</span> <span class="n">boot</span><span class="p">)</span>
                    <span class="n">sample_boot</span> <span class="o">=</span> <span class="n">energies</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">resampler</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="c1"># Compute the best along that axis</span>
                    <span class="n">boot_dist</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">sample_boot</span><span class="p">))</span>
    
                    <span class="n">occurences</span> <span class="o">=</span> <span class="n">occurrences</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">resampler</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">counts</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">energy</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sample_boot</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">energy</span> <span class="ow">in</span> <span class="n">counts</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="n">counts</span><span class="p">[</span><span class="n">energy</span><span class="p">]</span> <span class="o">+=</span> <span class="n">occurences</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">counts</span><span class="p">[</span><span class="n">energy</span><span class="p">]</span> <span class="o">=</span> <span class="n">occurences</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                    <span class="n">pr_dist</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">counts</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">key</span> <span class="o">&lt;</span> <span class="n">success</span><span class="p">)</span><span class="o">/</span><span class="n">boot</span><span class="p">)</span>   
                
                <span class="n">b</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">boot_dist</span><span class="p">[</span><span class="n">boot</span><span class="p">]))</span>
                <span class="c1"># Confidence intervals from bootstrapping the best out of boot</span>
                <span class="n">bnp</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">boot_dist</span><span class="p">[</span><span class="n">boot</span><span class="p">])</span>
                <span class="n">cilo</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">scoreatpercentile</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bnp</span><span class="p">[</span><span class="n">boot</span><span class="p">],</span> <span class="mf">50.</span><span class="o">-</span><span class="n">ci</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
                <span class="n">ciup</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">scoreatpercentile</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bnp</span><span class="p">[</span><span class="n">boot</span><span class="p">],</span> <span class="mf">50.</span><span class="o">+</span><span class="n">ci</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>  
                <span class="n">bcs</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">cilo</span><span class="p">[</span><span class="n">boot</span><span class="p">],</span><span class="n">ciup</span><span class="p">[</span><span class="n">boot</span><span class="p">]))</span>
                <span class="c1"># Confidence intervals from bootstrapping the TTS of boot</span>
                <span class="n">prob_np</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pr_dist</span><span class="p">[</span><span class="n">boot</span><span class="p">])</span>
                <span class="n">pr</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">prob_np</span><span class="p">[</span><span class="n">boot</span><span class="p">])</span>
                <span class="n">probs</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pr</span><span class="p">[</span><span class="n">boot</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">prob_np</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">time_to_sol</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
                    <span class="n">ttscs</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pr_cilo</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">scoreatpercentile</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">prob_np</span><span class="p">[</span><span class="n">boot</span><span class="p">],</span> <span class="mf">50.</span><span class="o">-</span><span class="n">ci</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
                    <span class="n">pr_ciup</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">scoreatpercentile</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">prob_np</span><span class="p">[</span><span class="n">boot</span><span class="p">],</span> <span class="mf">50.</span><span class="o">+</span><span class="n">ci</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
                    <span class="n">time_to_sol</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time_s</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">s</span><span class="p">)</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">pr</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span><span class="o">+</span><span class="mf">1e-9</span><span class="p">))</span> 
                    <span class="n">ttscs</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">time_s</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">s</span><span class="p">)</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">pr_cilo</span><span class="p">[</span><span class="n">boot</span><span class="p">]),</span><span class="n">time_s</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">s</span><span class="p">)</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">pr_ciup</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span><span class="o">+</span><span class="mf">1e-9</span><span class="p">)))</span>
            
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="n">schedule</span><span class="p">]</span> <span class="o">=</span> <span class="n">times</span>
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;min_energy&#39;</span><span class="p">][</span><span class="n">schedule</span><span class="p">]</span> <span class="o">=</span> <span class="n">min_energy</span>
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;random_energy&#39;</span><span class="p">][</span><span class="n">schedule</span><span class="p">]</span> <span class="o">=</span> <span class="n">random_energy</span>
        <span class="k">for</span> <span class="n">boot</span> <span class="ow">in</span> <span class="n">boots</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">][</span><span class="n">boot</span><span class="p">][</span><span class="n">schedule</span><span class="p">]</span> <span class="o">=</span> <span class="n">probs</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span>
            <span class="n">results</span><span class="p">[</span><span class="s1">&#39;tts&#39;</span><span class="p">][</span><span class="n">boot</span><span class="p">][</span><span class="n">schedule</span><span class="p">]</span> <span class="o">=</span> <span class="n">time_to_sol</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span>
            <span class="n">results</span><span class="p">[</span><span class="s1">&#39;ttsci&#39;</span><span class="p">][</span><span class="n">boot</span><span class="p">][</span><span class="n">schedule</span><span class="p">]</span> <span class="o">=</span> <span class="n">ttscs</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span>
            <span class="n">results</span><span class="p">[</span><span class="s1">&#39;best&#39;</span><span class="p">][</span><span class="n">boot</span><span class="p">][</span><span class="n">schedule</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">random_energy</span> <span class="o">-</span> <span class="n">energy</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">random_energy</span> <span class="o">-</span> <span class="n">min_energy</span><span class="p">)</span> <span class="k">for</span> <span class="n">energy</span> <span class="ow">in</span> <span class="n">b</span><span class="p">[</span><span class="n">boot</span><span class="p">]]</span>
            <span class="n">results</span><span class="p">[</span><span class="s1">&#39;bestci&#39;</span><span class="p">][</span><span class="n">boot</span><span class="p">][</span><span class="n">schedule</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">((</span><span class="n">random_energy</span> <span class="o">-</span> <span class="n">element</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">random_energy</span> <span class="o">-</span> <span class="n">min_energy</span><span class="p">)</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">energy</span><span class="p">)</span> <span class="k">for</span> <span class="n">energy</span> <span class="ow">in</span> <span class="n">bcs</span><span class="p">[</span><span class="n">boot</span><span class="p">]]</span>
    
    <span class="c1"># Save results file in case that we are interested in reusing them</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">results_name</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">))</span>
<span class="k">else</span><span class="p">:</span> <span class="c1"># Just reload processed datafile</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">results_name</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>After gathering all the results, we would like to see the progress of the approximation ration with respect to the increasing number of sweeps.
To account for the stochasticity of this method, we are bootstrapping all of our results with different values of the bootstrapping sample, and each confidence interval corresponds to a standard deviation away from the mean.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="k">for</span> <span class="n">boot</span> <span class="ow">in</span> <span class="n">boots</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">schedule</span> <span class="ow">in</span> <span class="n">schedules</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sweeps</span><span class="p">,</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;best&#39;</span><span class="p">][</span><span class="n">boot</span><span class="p">][</span><span class="n">schedule</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">schedule</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">boot</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; reads&#39;</span><span class="p">)</span>
        <span class="n">bestnp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;bestci&#39;</span><span class="p">][</span><span class="n">boot</span><span class="p">][</span><span class="n">schedule</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">sweeps</span><span class="p">,</span><span class="n">bestnp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">bestnp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Sweeps&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Performance ratio = </span><span class="se">\n</span><span class="s1"> &#39;</span> <span class="o">+</span> <span class="s1">&#39;(best found - random sample) / (min energy - random sample)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Simulated annealing performance ratio of Ising 42 N=100</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
          <span class="s1">&#39; with varying schedule, &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n_boot</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; bootstrap re-samples, and sweeps&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.15</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xscale</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">1.01</span><span class="p">])</span>
<span class="c1"># ax.set(xlim=[1,200])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(0.8, 1.01)]
</pre></div>
</div>
<img alt="_images/7a59545e282a2525d718e60bfa26f9d80cee8390c4b1a136274715a1dc9cf3f7.png" src="_images/7a59545e282a2525d718e60bfa26f9d80cee8390c4b1a136274715a1dc9cf3f7.png" />
</div>
</div>
<p>Now, besides looking at the sweeps, which are our parameter, we want to see how the performance changes with respect to the number of shots, which in this case are proportional to the computational time/effort that it takes to solve the problem.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="k">for</span> <span class="n">boot</span> <span class="ow">in</span> <span class="n">boots</span><span class="p">:</span>
    <span class="n">reads</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="o">*</span> <span class="n">boot</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sweeps</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">schedule</span> <span class="ow">in</span> <span class="n">schedules</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">reads</span><span class="p">,</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;best&#39;</span><span class="p">][</span><span class="n">boot</span><span class="p">][</span><span class="n">schedule</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">schedule</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; with &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">boot</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; reads&#39;</span><span class="p">)</span>
        <span class="n">bestnp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;bestci&#39;</span><span class="p">][</span><span class="n">boot</span><span class="p">][</span><span class="n">schedule</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">reads</span><span class="p">,</span><span class="n">bestnp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">bestnp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Total number of reads&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Performance ratio = </span><span class="se">\n</span><span class="s1"> &#39;</span> <span class="o">+</span> <span class="s1">&#39;(best found - random sample) / (min energy - random sample)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Simulated annealing performance ratio of Ising 42 N=100</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
          <span class="s1">&#39; with varying schedule, &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n_boot</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; bootstrap re-samples, and sweeps&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.15</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xscale</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">1.01</span><span class="p">])</span>
<span class="c1"># ax.set(xlim=[1,200])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(0.8, 1.01)]
</pre></div>
</div>
<img alt="_images/2a4c3ced50fb2fa5f0ff5a826b07cfa06270e8348ba488014256b491d7f7879c.png" src="_images/2a4c3ced50fb2fa5f0ff5a826b07cfa06270e8348ba488014256b491d7f7879c.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Simulated annealing expected runtime of </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
             <span class="s1">&#39; random Ising N=100 with varying schedule and sweeps&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">schedule</span> <span class="ow">in</span> <span class="n">schedules</span><span class="p">:</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sweeps</span><span class="p">,</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="n">schedule</span><span class="p">],</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">schedule</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="s1">&#39;geometric&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">sweeps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sweeps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
           <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Time [s]&#39;</span><span class="p">)</span>
<span class="c1"># ax1.set(xlim=[1,200])</span>


<span class="k">for</span> <span class="n">schedule</span> <span class="ow">in</span> <span class="n">schedules</span><span class="p">:</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">sweeps</span><span class="p">,</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">][</span><span class="n">default_sweeps</span><span class="p">][</span><span class="n">schedule</span><span class="p">],</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">schedule</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">][</span><span class="n">default_sweeps</span><span class="p">][</span><span class="s1">&#39;geometric&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">sweeps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sweeps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
           <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="c1"># ax2.set(xlim=[1,200])</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Success Probability </span><span class="se">\n</span><span class="s1"> (within &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">treshold</span><span class="p">)</span> <span class="o">+</span><span class="s1">&#39; </span><span class="si">% o</span><span class="s1">f best found)&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Sweeps&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">))</span>

<span class="c1"># Add plot going all the way to 1000 sweeps</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7bfa9d76fac0&gt;
</pre></div>
</div>
<img alt="_images/6158fd3afd37dc7bba94a7bac3370b0b3c148e9caac3f32a94f3f7268a06d44c.png" src="_images/6158fd3afd37dc7bba94a7bac3370b0b3c148e9caac3f32a94f3f7268a06d44c.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig1</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="k">for</span> <span class="n">boot</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">boots</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">schedule</span> <span class="ow">in</span> <span class="n">schedules</span><span class="p">:</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sweeps</span><span class="p">,</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;tts&#39;</span><span class="p">][</span><span class="n">boot</span><span class="p">][</span><span class="n">schedule</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">schedule</span> <span class="o">+</span> <span class="s2">&quot;_boot&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">boot</span><span class="p">))</span>
        <span class="n">ttsnp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;ttsci&#39;</span><span class="p">][</span><span class="n">boot</span><span class="p">][</span><span class="n">schedule</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">sweeps</span><span class="p">,</span><span class="n">ttsnp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ttsnp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>


<span class="n">ax1</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;tts&#39;</span><span class="p">][</span><span class="n">total_reads</span><span class="p">][</span><span class="s1">&#39;geometric&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">sweeps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sweeps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
           <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">yscale</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mf">1e3</span><span class="p">])</span>
<span class="c1"># ax1.set(xlim=[1,200])</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Time To Solution within &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">treshold</span><span class="p">)</span> <span class="o">+</span><span class="s1">&#39; </span><span class="si">% o</span><span class="s1">f best found [s]&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Sweeps&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Simulated annealing expected runtime of random Ising N=100</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
          <span class="s1">&#39; with varying schedule, &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n_boot</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; bootstrap re-samples, and sweeps&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">),</span>
          <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">fancybox</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">.45</span><span class="p">,</span> <span class="mf">.55</span><span class="p">,</span> <span class="mf">.4</span><span class="p">,</span> <span class="mf">.3</span><span class="p">])</span>
<span class="k">for</span> <span class="n">schedule</span> <span class="ow">in</span> <span class="n">schedules</span><span class="p">:</span>
    <span class="n">min_tts</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;tts&#39;</span><span class="p">][</span><span class="n">default_sweeps</span><span class="p">][</span><span class="n">schedule</span><span class="p">])</span>
    <span class="n">min_index</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;tts&#39;</span><span class="p">][</span><span class="n">default_sweeps</span><span class="p">][</span><span class="n">schedule</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">min_tts</span><span class="p">)</span>
    <span class="n">min_sweep</span> <span class="o">=</span> <span class="n">sweeps</span><span class="p">[</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;tts&#39;</span><span class="p">][</span><span class="n">default_sweeps</span><span class="p">][</span><span class="n">schedule</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">min_tts</span><span class="p">)]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;minimum TTS for &quot;</span> <span class="o">+</span> <span class="n">schedule</span> <span class="o">+</span> <span class="s2">&quot; schedule = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">min_tts</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;s at sweep = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">min_sweep</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">boot</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">boots</span><span class="p">):</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">sweeps</span><span class="p">[</span><span class="n">min_index</span><span class="o">-</span><span class="mi">10</span><span class="p">:</span><span class="n">min_index</span><span class="o">+</span><span class="mi">10</span><span class="p">],</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;tts&#39;</span><span class="p">][</span><span class="n">boot</span><span class="p">][</span><span class="n">schedule</span><span class="p">][</span><span class="n">min_index</span><span class="o">-</span><span class="mi">10</span><span class="p">:</span><span class="n">min_index</span><span class="o">+</span><span class="mi">10</span><span class="p">],</span> <span class="s1">&#39;-s&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;tts&#39;</span><span class="p">][</span><span class="n">default_sweeps</span><span class="p">][</span><span class="s1">&#39;geometric&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">sweeps</span><span class="p">[</span><span class="n">min_index</span><span class="o">-</span><span class="mi">10</span><span class="p">],</span> <span class="n">sweeps</span><span class="p">[</span><span class="n">min_index</span><span class="o">+</span><span class="mi">10</span><span class="p">],</span>
           <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;TTS [s]&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Sweeps&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>minimum TTS for geometric schedule = 3.2688155801866294s at sweep = 126
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Text(0.5, 0, &#39;Sweeps&#39;)]
</pre></div>
</div>
<img alt="_images/ab125cbb70875c10cf331ace8f5c163623a4b395f473db8816ea9ca4959a68a4.png" src="_images/ab125cbb70875c10cf331ace8f5c163623a4b395f473db8816ea9ca4959a68a4.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">min_beta_schedule</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span><span class="o">*</span><span class="n">simAnnSamplesDefault</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;beta_range&#39;</span><span class="p">],</span> <span class="n">num</span><span class="o">=</span><span class="n">min_sweep</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">beta_schedule</span><span class="p">,</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">min_beta_schedule</span><span class="p">,</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Sweeps&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;beta=Inverse temperature&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Geometric temperature schedule&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Default&#39;</span><span class="p">,</span><span class="s1">&#39;Best&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7bfa9d34db10&gt;
</pre></div>
</div>
<img alt="_images/39ea0aba9fc5d4d787f13165f5fbec63f23f584889b3096a4e68225070204a40.png" src="_images/39ea0aba9fc5d4d787f13165f5fbec63f23f584889b3096a4e68225070204a40.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="c1"># Best of boot samples es computed via n_boot bootstrapping</span>
<span class="c1"># n_boot=500</span>
<span class="n">boots</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">interest_sweeps</span> <span class="o">=</span> <span class="p">[</span><span class="n">min_sweep</span><span class="p">,</span> <span class="n">default_sweeps</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">500</span><span class="p">]</span>
<span class="n">approx_ratio</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">approx_ratioci</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">schedul</span> <span class="ow">in</span> <span class="n">schedules</span><span class="p">:</span>
    <span class="n">approx_ratio</span><span class="p">[</span><span class="n">schedule</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">approx_ratioci</span><span class="p">[</span><span class="n">schedule</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># Gather instance names</span>
<span class="n">instance</span> <span class="o">=</span> <span class="mi">42</span>
<span class="k">for</span> <span class="n">sweep</span> <span class="ow">in</span> <span class="n">interest_sweeps</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">schedule</span> <span class="ow">in</span> <span class="n">schedules</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sweep</span> <span class="ow">in</span> <span class="n">approx_ratio</span><span class="p">[</span><span class="n">schedule</span><span class="p">]</span> <span class="ow">and</span> <span class="n">sweep</span> <span class="ow">in</span> <span class="n">approx_ratioci</span><span class="p">[</span><span class="n">schedule</span><span class="p">]:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">min_energy</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;min_energy&#39;</span><span class="p">][</span><span class="n">schedule</span><span class="p">]</span>
            <span class="n">random_energy</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;random_energy&#39;</span><span class="p">][</span><span class="n">schedule</span><span class="p">]</span>

            <span class="n">pickle_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">schedule</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sweep</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.p&quot;</span>
            <span class="n">pickle_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pickle_path</span><span class="p">,</span> <span class="n">pickle_name</span><span class="p">)</span>
            <span class="c1"># If the instance data exists, load the data</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pickle_name</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overwrite_pickles</span><span class="p">:</span>
                <span class="c1"># print(pickle_name)</span>
                <span class="n">samples</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">pickle_name</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>
                <span class="n">time_s</span> <span class="o">=</span> <span class="n">samples</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;timing&#39;</span><span class="p">]</span>
            <span class="c1"># If it does not exist, generate the data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                <span class="n">samples</span> <span class="o">=</span> <span class="n">simAnnSampler</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">model_random</span><span class="p">,</span> <span class="n">num_reads</span><span class="o">=</span><span class="n">total_reads</span><span class="p">,</span> <span class="n">num_sweeps</span><span class="o">=</span><span class="n">sweep</span><span class="p">,</span> <span class="n">beta_schedule_type</span><span class="o">=</span><span class="n">schedule</span><span class="p">)</span>
                <span class="n">time_s</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
                <span class="n">samples</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;timing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time_s</span>
                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">pickle_name</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">))</span>
            <span class="c1"># Compute statistics</span>
            <span class="n">energies</span><span class="o">=</span><span class="n">samples</span><span class="o">.</span><span class="n">data_vectors</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">energies</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">min_energy</span><span class="p">:</span>
                <span class="n">min_energy</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">energies</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;A better solution of &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">min_energy</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; was found for sweep &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sweep</span><span class="p">))</span>

            <span class="n">b</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">bcs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">probs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">time_to_sol</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">boot</span> <span class="ow">in</span> <span class="n">boots</span><span class="p">:</span>
                <span class="n">boot_dist</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">pr_dist</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n_boot</span> <span class="o">-</span> <span class="n">boot</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)):</span>
                    <span class="n">resampler</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">total_reads</span><span class="p">,</span> <span class="n">boot</span><span class="p">)</span>
                    <span class="n">sample_boot</span> <span class="o">=</span> <span class="n">energies</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">resampler</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="c1"># Compute the best along that axis</span>
                    <span class="n">boot_dist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">sample_boot</span><span class="p">))</span>   
                
                <span class="n">b</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">boot_dist</span><span class="p">))</span>
                <span class="c1"># Confidence intervals from bootstrapping the best out of boot</span>
                <span class="n">bnp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">boot_dist</span><span class="p">)</span>
                <span class="n">cilo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">scoreatpercentile</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bnp</span><span class="p">,</span> <span class="mf">50.</span><span class="o">-</span><span class="n">ci</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
                <span class="n">ciup</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">scoreatpercentile</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bnp</span><span class="p">,</span> <span class="mf">50.</span><span class="o">+</span><span class="n">ci</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>  
                <span class="n">bcs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">cilo</span><span class="p">,</span><span class="n">ciup</span><span class="p">))</span>

            <span class="n">approx_ratio</span><span class="p">[</span><span class="n">schedule</span><span class="p">][</span><span class="n">sweep</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">random_energy</span> <span class="o">-</span> <span class="n">energy</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">random_energy</span> <span class="o">-</span> <span class="n">min_energy</span><span class="p">)</span> <span class="k">for</span> <span class="n">energy</span> <span class="ow">in</span> <span class="n">b</span><span class="p">]</span>
            <span class="n">approx_ratioci</span><span class="p">[</span><span class="n">schedule</span><span class="p">][</span><span class="n">sweep</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">((</span><span class="n">random_energy</span> <span class="o">-</span> <span class="n">element</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">random_energy</span> <span class="o">-</span> <span class="n">min_energy</span><span class="p">)</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">energy</span><span class="p">)</span> <span class="k">for</span> <span class="n">energy</span> <span class="ow">in</span> <span class="n">bcs</span><span class="p">]</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">shot</span><span class="o">*</span><span class="n">sweep</span> <span class="k">for</span> <span class="n">shot</span> <span class="ow">in</span> <span class="n">boots</span><span class="p">],</span> <span class="n">approx_ratio</span><span class="p">[</span><span class="n">schedule</span><span class="p">][</span><span class="n">sweep</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">sweep</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; sweeps&#39;</span><span class="p">)</span>
        <span class="n">approx_ratio_bestci_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">approx_ratioci</span><span class="p">[</span><span class="n">schedule</span><span class="p">][</span><span class="n">sweep</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">([</span><span class="n">shot</span><span class="o">*</span><span class="n">sweep</span> <span class="k">for</span> <span class="n">shot</span> <span class="ow">in</span> <span class="n">boots</span><span class="p">],</span><span class="n">approx_ratio_bestci_np</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">approx_ratio_bestci_np</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xscale</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mf">0.9</span><span class="p">,</span><span class="mf">1.01</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mf">1e2</span><span class="p">,</span><span class="mf">1e4</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Total number of reads (equivalent to time)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Performance ratio = </span><span class="se">\n</span><span class="s1"> &#39;</span> <span class="o">+</span> <span class="s1">&#39;(best found - random sample) / (min energy - random sample)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Simulated annealing performance ratio of Ising 42 N=100</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
          <span class="s1">&#39; with varying schedule, &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n_boot</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; bootstrap re-samples, and sweeps&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7bfa9d398190&gt;
</pre></div>
</div>
<img alt="_images/d77fdc1db023f6b91558defd778fd087900aa6cc4c44bc7887235c5475b73e35.png" src="_images/d77fdc1db023f6b91558defd778fd087900aa6cc4c44bc7887235c5475b73e35.png" />
</div>
</div>
<p>Here see how using the optimal number of sweeps is better than using other values (including the default recommended by the solver) in terms of solving this problem.
Obviously, we only know this after running the experiments and verifying it ourselves. This is not the usual case, so we want to see how well can we do if we solve similar (but no the same instances).
Here we will generate 20 random instances from the same distribution and size but different random seed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="mf">0.99</span>  <span class="c1"># This is the success probability for the TTS calculation</span>
<span class="n">treshold</span> <span class="o">=</span> <span class="mf">5.0</span>  <span class="c1"># This is a percentual treshold of what the minimum energy should be</span>
<span class="n">sweeps</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">chain</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">250</span><span class="p">,</span> <span class="mi">1001</span><span class="p">,</span> <span class="mi">10</span><span class="p">)))</span>
<span class="c1"># schedules = [&#39;geometric&#39;, &#39;linear&#39;]</span>
<span class="n">schedules</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;geometric&#39;</span><span class="p">]</span>
<span class="n">total_reads</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">default_sweeps</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="c1"># boots = [1, 10, 100, default_sweeps]</span>
<span class="n">boots</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">default_sweeps</span><span class="p">]</span>
<span class="n">all_results</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">instances</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>

<span class="n">all_results_name</span> <span class="o">=</span> <span class="s2">&quot;all_results.pkl&quot;</span>
<span class="n">all_results_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pickle_path</span><span class="p">,</span> <span class="n">all_results_name</span><span class="p">)</span>
<span class="c1"># If you wanto to use the raw data and process it here</span>
<span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">all_results_name</span><span class="p">)):</span>

    <span class="k">for</span> <span class="n">instance</span> <span class="ow">in</span> <span class="n">instances</span><span class="p">:</span>
        <span class="n">all_results</span><span class="p">[</span><span class="n">instance</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">all_results</span><span class="p">[</span><span class="n">instance</span><span class="p">][</span><span class="s1">&#39;p&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">all_results</span><span class="p">[</span><span class="n">instance</span><span class="p">][</span><span class="s1">&#39;min_energy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">all_results</span><span class="p">[</span><span class="n">instance</span><span class="p">][</span><span class="s1">&#39;random_energy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">all_results</span><span class="p">[</span><span class="n">instance</span><span class="p">][</span><span class="s1">&#39;tts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">all_results</span><span class="p">[</span><span class="n">instance</span><span class="p">][</span><span class="s1">&#39;ttsci&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">all_results</span><span class="p">[</span><span class="n">instance</span><span class="p">][</span><span class="s1">&#39;t&#39;</span><span class="p">]</span><span class="o">=</span> <span class="p">{}</span>
        <span class="n">all_results</span><span class="p">[</span><span class="n">instance</span><span class="p">][</span><span class="s1">&#39;best&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">all_results</span><span class="p">[</span><span class="n">instance</span><span class="p">][</span><span class="s1">&#39;bestci&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>  <span class="c1"># Fixing the random seed to get the same result</span>
        <span class="n">J</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
        <span class="c1"># We only consider upper triangular matrix ignoring the diagonal</span>
        <span class="n">J</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">J</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
        <span class="n">model_random</span> <span class="o">=</span> <span class="n">dimod</span><span class="o">.</span><span class="n">BinaryQuadraticModel</span><span class="o">.</span><span class="n">from_ising</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

        <span class="n">randomSample</span> <span class="o">=</span> <span class="n">randomSampler</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">model_random</span><span class="p">,</span> <span class="n">num_reads</span><span class="o">=</span><span class="n">total_reads</span><span class="p">)</span>
        <span class="n">random_energies</span> <span class="o">=</span> <span class="p">[</span><span class="n">datum</span><span class="o">.</span><span class="n">energy</span> <span class="k">for</span> <span class="n">datum</span> <span class="ow">in</span> <span class="n">randomSample</span><span class="o">.</span><span class="n">data</span><span class="p">(</span>
                <span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">])]</span>
        <span class="n">random_energy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">random_energies</span><span class="p">)</span>

        <span class="n">default_pickle_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_geometric_1000.p&quot;</span>
        <span class="n">default_pickle_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pickle_path</span><span class="p">,</span> <span class="n">default_pickle_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">default_pickle_name</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overwrite_pickles</span><span class="p">:</span>
            <span class="n">simAnnSamplesDefault</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">default_pickle_name</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>
            <span class="n">timeDefault</span> <span class="o">=</span> <span class="n">simAnnSamplesDefault</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;timing&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">simAnnSamplesDefault</span> <span class="o">=</span> <span class="n">simAnnSampler</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">model_random</span><span class="p">,</span> <span class="n">num_reads</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
            <span class="n">timeDefault</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
            <span class="n">simAnnSamplesDefault</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;timing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">timeDefault</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">simAnnSamplesDefault</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">default_pickle_name</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">))</span>
        <span class="n">energies</span> <span class="o">=</span> <span class="p">[</span><span class="n">datum</span><span class="o">.</span><span class="n">energy</span> <span class="k">for</span> <span class="n">datum</span> <span class="ow">in</span> <span class="n">simAnnSamplesDefault</span><span class="o">.</span><span class="n">data</span><span class="p">(</span>
            <span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">],</span> <span class="n">sorted_by</span><span class="o">=</span><span class="s1">&#39;energy&#39;</span><span class="p">)]</span>
        <span class="n">min_energy</span> <span class="o">=</span> <span class="n">energies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">schedule</span> <span class="ow">in</span> <span class="n">schedules</span><span class="p">:</span>

            <span class="n">all_results</span><span class="p">[</span><span class="n">instance</span><span class="p">][</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="n">schedule</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">all_results</span><span class="p">[</span><span class="n">instance</span><span class="p">][</span><span class="s1">&#39;min_energy&#39;</span><span class="p">][</span><span class="n">schedule</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">all_results</span><span class="p">[</span><span class="n">instance</span><span class="p">][</span><span class="s1">&#39;random_energy&#39;</span><span class="p">][</span><span class="n">schedule</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">all_results</span><span class="p">[</span><span class="n">instance</span><span class="p">][</span><span class="s1">&#39;p&#39;</span><span class="p">][</span><span class="n">schedule</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">all_results</span><span class="p">[</span><span class="n">instance</span><span class="p">][</span><span class="s1">&#39;tts&#39;</span><span class="p">][</span><span class="n">schedule</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">all_results</span><span class="p">[</span><span class="n">instance</span><span class="p">][</span><span class="s1">&#39;ttsci&#39;</span><span class="p">][</span><span class="n">schedule</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">all_results</span><span class="p">[</span><span class="n">instance</span><span class="p">][</span><span class="s1">&#39;best&#39;</span><span class="p">][</span><span class="n">schedule</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">all_results</span><span class="p">[</span><span class="n">instance</span><span class="p">][</span><span class="s1">&#39;bestci&#39;</span><span class="p">][</span><span class="n">schedule</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="c1"># probs = []</span>
            <span class="n">probs</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">boots</span><span class="p">}</span>
            <span class="n">time_to_sol</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">boots</span><span class="p">}</span>
            <span class="n">prob_np</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">boots</span><span class="p">}</span>
            <span class="n">ttscs</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">boots</span><span class="p">}</span>
            <span class="n">times</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">b</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">boots</span><span class="p">}</span>
            <span class="n">bnp</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">boots</span><span class="p">}</span>
            <span class="n">bcs</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">boots</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">sweep</span> <span class="ow">in</span> <span class="n">sweeps</span><span class="p">:</span>
                <span class="c1"># Gather instance names</span>
                <span class="n">pickle_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">schedule</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sweep</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.p&quot;</span>
                <span class="n">pickle_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pickle_path</span><span class="p">,</span> <span class="n">pickle_name</span><span class="p">)</span>
                <span class="c1"># If the instance data exists, load the data</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pickle_name</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overwrite_pickles</span><span class="p">:</span>
                    <span class="n">samples</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">pickle_name</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>
                    <span class="n">time_s</span> <span class="o">=</span> <span class="n">samples</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;timing&#39;</span><span class="p">]</span>
                <span class="c1"># If it does not exist, generate the data</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                    <span class="n">samples</span> <span class="o">=</span> <span class="n">simAnnSampler</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
                        <span class="n">model_random</span><span class="p">,</span> <span class="n">num_reads</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">num_sweeps</span><span class="o">=</span><span class="n">sweep</span><span class="p">,</span> <span class="n">beta_schedule_type</span><span class="o">=</span><span class="n">schedule</span><span class="p">)</span>
                    <span class="n">time_s</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
                    <span class="n">samples</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;timing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time_s</span>
                    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">pickle_name</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">))</span>
                <span class="c1"># Compute statistics</span>
                <span class="n">energies</span> <span class="o">=</span> <span class="n">samples</span><span class="o">.</span><span class="n">data_vectors</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">]</span>
                <span class="n">occurrences</span> <span class="o">=</span> <span class="n">samples</span><span class="o">.</span><span class="n">data_vectors</span><span class="p">[</span><span class="s1">&#39;num_occurrences&#39;</span><span class="p">]</span>
                <span class="n">total_counts</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">occurrences</span><span class="p">)</span>
                <span class="n">times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time_s</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">energies</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">min_energy</span><span class="p">:</span>
                    <span class="n">min_energy</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">energies</span><span class="p">)</span>
                    <span class="c1"># print(&quot;A better solution of &quot; + str(min_energy) + &quot; was found for sweep &quot; + str(sweep))</span>
                <span class="c1"># success = min_energy*(1.0 + treshold/100.0)**np.sign(min_energy)</span>
                <span class="n">success</span> <span class="o">=</span> <span class="n">random_energy</span> <span class="o">-</span> <span class="p">(</span><span class="n">random_energy</span> <span class="o">-</span> <span class="n">min_energy</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">treshold</span><span class="o">/</span><span class="mf">100.0</span><span class="p">)</span>
                
                <span class="c1"># Best of boot samples es computed via n_boot bootstrapping</span>
                <span class="n">ci</span><span class="o">=</span><span class="mi">68</span>
                <span class="n">boot_dist</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">pr_dist</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">cilo</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">ciup</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">pr</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">pr_cilo</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">pr_ciup</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">boot</span> <span class="ow">in</span> <span class="n">boots</span><span class="p">:</span>
                    <span class="n">boot_dist</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">pr_dist</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n_boot</span><span class="p">)):</span>
                        <span class="n">resampler</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">total_reads</span><span class="p">,</span> <span class="n">boot</span><span class="p">)</span>
                        <span class="n">sample_boot</span> <span class="o">=</span> <span class="n">energies</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">resampler</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                        <span class="c1"># Compute the best along that axis</span>
                        <span class="n">boot_dist</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">sample_boot</span><span class="p">))</span>
        
                        <span class="n">occurences</span> <span class="o">=</span> <span class="n">occurrences</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">resampler</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                        <span class="n">counts</span> <span class="o">=</span> <span class="p">{}</span>
                        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">energy</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sample_boot</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">energy</span> <span class="ow">in</span> <span class="n">counts</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                                <span class="n">counts</span><span class="p">[</span><span class="n">energy</span><span class="p">]</span> <span class="o">+=</span> <span class="n">occurences</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">counts</span><span class="p">[</span><span class="n">energy</span><span class="p">]</span> <span class="o">=</span> <span class="n">occurences</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                        <span class="n">pr_dist</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">counts</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">key</span> <span class="o">&lt;</span> <span class="n">success</span><span class="p">)</span><span class="o">/</span><span class="n">boot</span><span class="p">)</span>
                    <span class="n">prob_np</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pr_dist</span><span class="p">[</span><span class="n">boot</span><span class="p">])</span>
                    <span class="n">pr</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">prob_np</span><span class="p">[</span><span class="n">boot</span><span class="p">])</span>
                    <span class="n">probs</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pr</span><span class="p">[</span><span class="n">boot</span><span class="p">])</span>
                    
                    <span class="n">b</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">boot_dist</span><span class="p">[</span><span class="n">boot</span><span class="p">]))</span>
                    <span class="c1"># Confidence intervals from bootstrapping the best out of boot</span>
                    <span class="n">bnp</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">boot_dist</span><span class="p">[</span><span class="n">boot</span><span class="p">])</span>
                    <span class="n">cilo</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">scoreatpercentile</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bnp</span><span class="p">[</span><span class="n">boot</span><span class="p">],</span> <span class="mf">50.</span><span class="o">-</span><span class="n">ci</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
                    <span class="n">ciup</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">scoreatpercentile</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bnp</span><span class="p">[</span><span class="n">boot</span><span class="p">],</span> <span class="mf">50.</span><span class="o">+</span><span class="n">ci</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>  
                    <span class="n">bcs</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">cilo</span><span class="p">[</span><span class="n">boot</span><span class="p">],</span><span class="n">ciup</span><span class="p">[</span><span class="n">boot</span><span class="p">]))</span>
                    <span class="c1"># Confidence intervals from bootstrapping the TTS of boot</span>
                    <span class="k">if</span> <span class="n">prob_np</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">time_to_sol</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
                        <span class="n">ttscs</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">pr_cilo</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">scoreatpercentile</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">prob_np</span><span class="p">[</span><span class="n">boot</span><span class="p">],</span> <span class="mf">50.</span><span class="o">-</span><span class="n">ci</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
                        <span class="n">pr_ciup</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">scoreatpercentile</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">prob_np</span><span class="p">[</span><span class="n">boot</span><span class="p">],</span> <span class="mf">50.</span><span class="o">+</span><span class="n">ci</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
                        <span class="n">time_to_sol</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time_s</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">s</span><span class="p">)</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">pr</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span><span class="o">+</span><span class="mf">1e-9</span><span class="p">))</span>   
                        <span class="n">ttscs</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">time_s</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">s</span><span class="p">)</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">pr_cilo</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span><span class="o">+</span><span class="mf">1e-9</span><span class="p">),</span><span class="n">time_s</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">s</span><span class="p">)</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">pr_ciup</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span><span class="o">+</span><span class="mf">1e-9</span><span class="p">)))</span>
                    

            <span class="n">all_results</span><span class="p">[</span><span class="n">instance</span><span class="p">][</span><span class="s1">&#39;t&#39;</span><span class="p">][</span><span class="n">schedule</span><span class="p">][</span><span class="n">default_sweeps</span><span class="p">]</span> <span class="o">=</span> <span class="n">times</span>
            <span class="n">all_results</span><span class="p">[</span><span class="n">instance</span><span class="p">][</span><span class="s1">&#39;min_energy&#39;</span><span class="p">][</span><span class="n">schedule</span><span class="p">][</span><span class="n">default_sweeps</span><span class="p">]</span> <span class="o">=</span> <span class="n">min_energy</span>
            <span class="n">all_results</span><span class="p">[</span><span class="n">instance</span><span class="p">][</span><span class="s1">&#39;random_energy&#39;</span><span class="p">][</span><span class="n">schedule</span><span class="p">][</span><span class="n">default_sweeps</span><span class="p">]</span> <span class="o">=</span> <span class="n">random_energy</span>
            <span class="k">for</span> <span class="n">boot</span> <span class="ow">in</span> <span class="n">boots</span><span class="p">:</span>
                <span class="n">all_results</span><span class="p">[</span><span class="n">instance</span><span class="p">][</span><span class="s1">&#39;p&#39;</span><span class="p">][</span><span class="n">schedule</span><span class="p">][</span><span class="n">boot</span><span class="p">]</span> <span class="o">=</span> <span class="n">probs</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span>
                <span class="n">all_results</span><span class="p">[</span><span class="n">instance</span><span class="p">][</span><span class="s1">&#39;tts&#39;</span><span class="p">][</span><span class="n">schedule</span><span class="p">][</span><span class="n">boot</span><span class="p">]</span> <span class="o">=</span> <span class="n">time_to_sol</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span>
                <span class="n">all_results</span><span class="p">[</span><span class="n">instance</span><span class="p">][</span><span class="s1">&#39;ttsci&#39;</span><span class="p">][</span><span class="n">schedule</span><span class="p">][</span><span class="n">boot</span><span class="p">]</span> <span class="o">=</span> <span class="n">ttscs</span><span class="p">[</span><span class="n">boot</span><span class="p">]</span>
                <span class="n">all_results</span><span class="p">[</span><span class="n">instance</span><span class="p">][</span><span class="s1">&#39;best&#39;</span><span class="p">][</span><span class="n">schedule</span><span class="p">][</span><span class="n">boot</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">random_energy</span> <span class="o">-</span> <span class="n">energy</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">random_energy</span> <span class="o">-</span> <span class="n">min_energy</span><span class="p">)</span> <span class="k">for</span> <span class="n">energy</span> <span class="ow">in</span> <span class="n">b</span><span class="p">[</span><span class="n">boot</span><span class="p">]]</span>
                <span class="n">all_results</span><span class="p">[</span><span class="n">instance</span><span class="p">][</span><span class="s1">&#39;bestci&#39;</span><span class="p">][</span><span class="n">schedule</span><span class="p">][</span><span class="n">boot</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">((</span><span class="n">random_energy</span> <span class="o">-</span> <span class="n">element</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">random_energy</span> <span class="o">-</span> <span class="n">min_energy</span><span class="p">)</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">energy</span><span class="p">)</span> <span class="k">for</span> <span class="n">energy</span> <span class="ow">in</span> <span class="n">bcs</span><span class="p">[</span><span class="n">boot</span><span class="p">]]</span>

    <span class="c1"># Save results file in case that we are interested in reusing them</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">all_results</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">all_results_name</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">))</span>
<span class="k">else</span><span class="p">:</span> <span class="c1"># Just reload processed datafile</span>
    <span class="n">all_results</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">all_results_name</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">bootstrap</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">n_boot</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="mi">68</span><span class="p">):</span>
    <span class="n">boot_dist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n_boot</span><span class="p">)):</span>
        <span class="n">resampler</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">sample</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">resampler</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># Median ignoring nans instead of mean</span>
        <span class="n">boot_dist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">boot_dist</span><span class="p">)</span>
    <span class="n">s1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">scoreatpercentile</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="mf">50.</span><span class="o">-</span><span class="n">ci</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
    <span class="n">s2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">scoreatpercentile</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="mf">50.</span><span class="o">+</span><span class="n">ci</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">s1</span><span class="p">,</span><span class="n">s2</span><span class="p">)</span>
    
<span class="k">def</span> <span class="nf">tsplotboot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">error_est</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="c1"># Median ignoring nans instead of mean</span>
    <span class="n">est</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">est</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">error_est</span> <span class="o">==</span> <span class="s1">&#39;bootstrap&#39;</span><span class="p">:</span>
        <span class="n">cis</span> <span class="o">=</span> <span class="n">bootstrap</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">error_est</span> <span class="o">==</span> <span class="s1">&#39;std&#39;</span><span class="p">:</span>
        <span class="n">sd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">cis</span> <span class="o">=</span> <span class="p">(</span><span class="n">est</span> <span class="o">-</span> <span class="n">sd</span><span class="p">,</span> <span class="n">est</span> <span class="o">+</span> <span class="n">sd</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span><span class="n">cis</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">mask</span><span class="p">],</span><span class="n">cis</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">mask</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.35</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span><span class="n">est</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we bootstrap our solutions with respect to the whole set of instances, or ensemble, and we use the median which respresents the solution better than the mean.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="k">for</span> <span class="n">boot</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">boots</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">schedule</span> <span class="ow">in</span> <span class="n">schedules</span><span class="p">:</span>
        <span class="n">results_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_results</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;tts&#39;</span><span class="p">][</span><span class="n">schedule</span><span class="p">][</span><span class="n">boot</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">)])</span>
        <span class="n">min_median_tts</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">results_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
        <span class="n">tsplotboot</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">sweeps</span><span class="p">),</span> <span class="n">data</span><span class="o">=</span><span class="n">results_array</span><span class="p">,</span> <span class="n">error_est</span><span class="o">=</span><span class="s1">&#39;bootstrap&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Ensemble &quot;</span> <span class="o">+</span> <span class="n">schedule</span> <span class="o">+</span> <span class="s1">&#39; with &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">boot</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; reads&#39;</span><span class="p">)</span>

        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sweeps</span><span class="p">,</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;tts&#39;</span><span class="p">][</span><span class="n">boot</span><span class="p">][</span><span class="n">schedule</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Instance &quot;</span> <span class="o">+</span> <span class="n">schedule</span> <span class="o">+</span> <span class="s2">&quot;_boot&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">boot</span><span class="p">))</span>


<span class="n">ax1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">yscale</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Time To Solution within &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">treshold</span><span class="p">)</span> <span class="o">+</span><span class="s1">&#39; </span><span class="si">% o</span><span class="s1">f best found [s]&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Sweeps&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Simulated annealing expected runtime of </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
          <span class="s1">&#39; Ising 42 N=100 with varying schedule and sweeps&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">),</span>
          <span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">fancybox</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">.45</span><span class="p">,</span> <span class="mf">.55</span><span class="p">,</span> <span class="mf">.4</span><span class="p">,</span> <span class="mf">.3</span><span class="p">])</span>
<span class="k">for</span> <span class="n">schedule</span> <span class="ow">in</span> <span class="n">schedules</span><span class="p">:</span>
    <span class="n">results_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_results</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;tts&#39;</span><span class="p">][</span><span class="n">schedule</span><span class="p">][</span><span class="n">default_sweeps</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">)])</span>
    <span class="n">min_median_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">results_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">min_median_sweep</span> <span class="o">=</span> <span class="n">sweeps</span><span class="p">[</span><span class="n">min_median_index</span><span class="p">]</span>
    <span class="n">min_tts</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;tts&#39;</span><span class="p">][</span><span class="n">default_sweeps</span><span class="p">][</span><span class="n">schedule</span><span class="p">])</span>
    <span class="n">min_index</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;tts&#39;</span><span class="p">][</span><span class="n">default_sweeps</span><span class="p">][</span><span class="n">schedule</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">min_tts</span><span class="p">)</span>
    <span class="n">min_sweep</span> <span class="o">=</span> <span class="n">sweeps</span><span class="p">[</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;tts&#39;</span><span class="p">][</span><span class="n">default_sweeps</span><span class="p">][</span><span class="n">schedule</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">min_tts</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">min_sweep</span> <span class="o">&lt;</span> <span class="n">min_median_sweep</span><span class="p">:</span>
        <span class="n">index_lo</span> <span class="o">=</span> <span class="n">min_index</span>
        <span class="n">index_hi</span> <span class="o">=</span> <span class="n">min_median_index</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">index_lo</span> <span class="o">=</span> <span class="n">min_median_index</span>
        <span class="n">index_hi</span> <span class="o">=</span> <span class="n">min_index</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;minimum median TTS for &quot;</span> <span class="o">+</span> <span class="n">schedule</span> <span class="o">+</span> <span class="s2">&quot; schedule = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">min_median_tts</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;s at sweep = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">min_median_sweep</span><span class="p">))</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">sweeps</span><span class="p">[</span><span class="n">index_lo</span><span class="o">-</span><span class="mi">5</span><span class="p">:</span><span class="n">index_hi</span><span class="o">+</span><span class="mi">5</span><span class="p">],</span>
        <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">([</span><span class="n">all_results</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;tts&#39;</span><span class="p">][</span><span class="n">schedule</span><span class="p">][</span><span class="n">default_sweeps</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">)],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="p">[</span><span class="n">index_lo</span><span class="o">-</span><span class="mi">5</span><span class="p">:</span><span class="n">index_hi</span><span class="o">+</span><span class="mi">5</span><span class="p">],</span> <span class="s1">&#39;-s&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;minimum TTS for instance 42 with &quot;</span> <span class="o">+</span> <span class="n">schedule</span> <span class="o">+</span> <span class="s2">&quot; schedule = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">min_tts</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;s at sweep = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">min_sweep</span><span class="p">))</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">sweeps</span><span class="p">[</span><span class="n">index_lo</span><span class="o">-</span><span class="mi">5</span><span class="p">:</span><span class="n">index_hi</span><span class="o">+</span><span class="mi">5</span><span class="p">],</span> 
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;tts&#39;</span><span class="p">][</span><span class="n">default_sweeps</span><span class="p">][</span><span class="n">schedule</span><span class="p">][</span><span class="n">index_lo</span><span class="o">-</span><span class="mi">5</span><span class="p">:</span><span class="n">index_hi</span><span class="o">+</span><span class="mi">5</span><span class="p">],</span> <span class="s1">&#39;-s&#39;</span><span class="p">)</span>
    
    
<span class="n">ax2</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">([</span><span class="n">all_results</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;tts&#39;</span><span class="p">][</span><span class="n">schedule</span><span class="p">][</span><span class="n">default_sweeps</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">)]),</span>
        <span class="n">sweeps</span><span class="p">[</span><span class="n">index_lo</span><span class="o">-</span><span class="mi">5</span><span class="p">],</span> <span class="n">sweeps</span><span class="p">[</span><span class="n">index_hi</span><span class="o">+</span><span class="mi">5</span><span class="p">],</span>
           <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;TTS [s]&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Sweeps&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>minimum median TTS for geometric schedule = infs at sweep = 137
minimum TTS for instance 42 with geometric schedule = 3.2688155801866294s at sweep = 126
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Text(0.5, 0, &#39;Sweeps&#39;)]
</pre></div>
</div>
<img alt="_images/fb6a11e8d988f0663f8fbe4d203db00b1138e11c6f828af6c6b20428c613010f.png" src="_images/fb6a11e8d988f0663f8fbe4d203db00b1138e11c6f828af6c6b20428c613010f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="k">for</span> <span class="n">boot</span> <span class="ow">in</span> <span class="n">boots</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">schedule</span> <span class="ow">in</span> <span class="n">schedules</span><span class="p">:</span>
        <span class="n">best_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_results</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;best&#39;</span><span class="p">][</span><span class="n">schedule</span><span class="p">][</span><span class="n">boot</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">)])</span>
        <span class="c1"># min_median_best = min(np.nanmedian(results_array, axis=0))</span>
        <span class="n">tsplotboot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">sweeps</span><span class="p">),</span> <span class="n">data</span><span class="o">=</span><span class="n">best_array</span><span class="p">,</span> <span class="n">error_est</span><span class="o">=</span><span class="s1">&#39;bootstrap&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Ensemble &quot;</span> <span class="o">+</span> <span class="n">schedule</span> <span class="o">+</span> <span class="s1">&#39; with &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">boot</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; reads&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Sweeps&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Performance ratio </span><span class="se">\n</span><span class="s1"> = best found / min energy&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Simulated annealing performance ratio of </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
          <span class="s1">&#39; Ensemble of Ising N=100 with varying schedule, sweeps, and number of reads&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.15</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xscale</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">1.01</span><span class="p">])</span>
<span class="c1"># ax.set(xlim=[1,200])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(0.8, 1.01)]
</pre></div>
</div>
<img alt="_images/1409cb599ecc9f524ce79ef20e7a58c6c8cbed86b10951115bf3cf371a40f829.png" src="_images/1409cb599ecc9f524ce79ef20e7a58c6c8cbed86b10951115bf3cf371a40f829.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="k">for</span> <span class="n">boot</span> <span class="ow">in</span> <span class="n">boots</span><span class="p">:</span>
    <span class="n">reads</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="o">*</span> <span class="n">boot</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sweeps</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">schedule</span> <span class="ow">in</span> <span class="n">schedules</span><span class="p">:</span>
        <span class="n">best_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_results</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;best&#39;</span><span class="p">][</span><span class="n">schedule</span><span class="p">][</span><span class="n">boot</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">)])</span>
        <span class="c1"># min_median_best = min(np.nanmedian(results_array, axis=0))</span>
        <span class="n">tsplotboot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">reads</span><span class="p">),</span> <span class="n">data</span><span class="o">=</span><span class="n">best_array</span><span class="p">,</span> <span class="n">error_est</span><span class="o">=</span><span class="s1">&#39;bootstrap&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Ensemble &quot;</span> <span class="o">+</span> <span class="n">schedule</span> <span class="o">+</span> <span class="s1">&#39; with &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">boot</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; reads&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Total number of reads&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Performance ratio </span><span class="se">\n</span><span class="s1"> = best found / min energy&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Simulated annealing performance ratio of </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
          <span class="s1">&#39; Ensemble of Ising N=100 with varying schedule, sweeps, and number of reads&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.15</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xscale</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">1.01</span><span class="p">])</span>
<span class="c1"># ax.set(xlim=[1,200])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(0.8, 1.01)]
</pre></div>
</div>
<img alt="_images/96cd5008ac3e228e26c9590a8d4c0a23780b72743b983c9093408fd4f59e29d3.png" src="_images/96cd5008ac3e228e26c9590a8d4c0a23780b72743b983c9093408fd4f59e29d3.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">instances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">all_results</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;tts&#39;</span><span class="p">][</span><span class="s1">&#39;geometric&#39;</span><span class="p">][</span><span class="n">default_sweeps</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">)]</span>
<span class="n">minima</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">all_results</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;tts&#39;</span><span class="p">][</span><span class="s1">&#39;geometric&#39;</span><span class="p">][</span><span class="n">default_sweeps</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">)]</span>
<span class="n">default</span> <span class="o">=</span> <span class="p">[</span><span class="n">all_results</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;tts&#39;</span><span class="p">][</span><span class="s1">&#39;geometric&#39;</span><span class="p">][</span><span class="n">default_sweeps</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">)]</span>
<span class="n">median_all</span> <span class="o">=</span> <span class="p">[</span><span class="n">all_results</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;tts&#39;</span><span class="p">][</span><span class="s1">&#39;geometric&#39;</span><span class="p">][</span><span class="n">default_sweeps</span><span class="p">][</span><span class="n">min_median_index</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">)]</span>


<span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">instances</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">minima</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;virtual best&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">instances</span><span class="p">,</span> <span class="n">median_all</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;median&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">instances</span><span class="o">+</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">default</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_major_locator</span><span class="p">()</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Instance&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Time To Solution within &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">treshold</span><span class="p">)</span> <span class="o">+</span><span class="s1">&#39; </span><span class="si">% o</span><span class="s1">f best found [s]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7bfa9d9e7310&gt;
</pre></div>
</div>
<img alt="_images/3dd989b0a1d670a6d3a15cc97d57982a0b3a92a041b5deb05f13921f113bb99e.png" src="_images/3dd989b0a1d670a6d3a15cc97d57982a0b3a92a041b5deb05f13921f113bb99e.png" />
</div>
</div>
<p>Notice how much performance would we be losing if we had used the default value for all these instances, and how much we could eventually win if we knew the best for each.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">interest_sweeps</span> <span class="o">=</span> <span class="p">[</span><span class="n">min_sweep</span><span class="p">,</span> <span class="n">total_reads</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">500</span><span class="p">]</span>
<span class="n">interest_sweeps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">min_median_sweep</span><span class="p">)</span>
<span class="n">shots</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">n_boot</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="c1"># Gather instance names</span>
<span class="n">instance</span> <span class="o">=</span> <span class="mi">42</span>
<span class="k">for</span> <span class="n">sweep</span> <span class="ow">in</span> <span class="n">interest_sweeps</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">schedule</span> <span class="ow">in</span> <span class="n">schedules</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sweep</span> <span class="ow">in</span> <span class="n">approx_ratio</span><span class="p">[</span><span class="n">schedule</span><span class="p">]</span> <span class="ow">and</span> <span class="n">sweep</span> <span class="ow">in</span> <span class="n">approx_ratioci</span><span class="p">[</span><span class="n">schedule</span><span class="p">]:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">min_energy</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;min_energy&#39;</span><span class="p">][</span><span class="n">schedule</span><span class="p">]</span>
            <span class="n">random_energy</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;random_energy&#39;</span><span class="p">][</span><span class="n">schedule</span><span class="p">]</span>
            
            <span class="n">pickle_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">schedule</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sweep</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.p&quot;</span>
            <span class="n">pickle_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pickle_path</span><span class="p">,</span> <span class="n">pickle_name</span><span class="p">)</span>
            <span class="c1"># If the instance data exists, load the data</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pickle_name</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overwrite_pickles</span><span class="p">:</span>
                <span class="c1"># print(pickle_name)</span>
                <span class="n">samples</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">pickle_name</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>
                <span class="n">time_s</span> <span class="o">=</span> <span class="n">samples</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;timing&#39;</span><span class="p">]</span>
            <span class="c1"># If it does not exist, generate the data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                <span class="n">samples</span> <span class="o">=</span> <span class="n">simAnnSampler</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">model_random</span><span class="p">,</span> <span class="n">num_reads</span><span class="o">=</span><span class="n">total_reads</span><span class="p">,</span> <span class="n">num_sweeps</span><span class="o">=</span><span class="n">sweep</span><span class="p">,</span> <span class="n">beta_schedule_type</span><span class="o">=</span><span class="n">schedule</span><span class="p">)</span>
                <span class="n">time_s</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
                <span class="n">samples</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;timing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time_s</span>
                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">pickle_name</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">))</span>
            <span class="c1"># Compute statistics</span>
            <span class="n">energies</span><span class="o">=</span><span class="n">samples</span><span class="o">.</span><span class="n">data_vectors</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">energies</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">min_energy</span><span class="p">:</span>
                <span class="n">min_energy</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">energies</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;A better solution of &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">min_energy</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; was found for sweep &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sweep</span><span class="p">))</span>

            <span class="n">b</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">bcs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">probs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">time_to_sol</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">shot</span> <span class="ow">in</span> <span class="n">shots</span><span class="p">:</span>
                <span class="n">shot_dist</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">pr_dist</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n_boot</span> <span class="o">-</span> <span class="n">shot</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)):</span>
                    <span class="n">resampler</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">total_reads</span><span class="p">,</span> <span class="n">shot</span><span class="p">)</span>
                    <span class="n">sample_shot</span> <span class="o">=</span> <span class="n">energies</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">resampler</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="c1"># Compute the best along that axis</span>
                    <span class="n">shot_dist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">sample_shot</span><span class="p">))</span>   
                
                <span class="n">b</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">shot_dist</span><span class="p">))</span>
                <span class="c1"># Confidence intervals from bootstrapping the best out of shot</span>
                <span class="n">bnp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">shot_dist</span><span class="p">)</span>
                <span class="n">cilo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">scoreatpercentile</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bnp</span><span class="p">,</span> <span class="mf">50.</span><span class="o">-</span><span class="n">ci</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
                <span class="n">ciup</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">scoreatpercentile</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bnp</span><span class="p">,</span> <span class="mf">50.</span><span class="o">+</span><span class="n">ci</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>  
                <span class="n">bcs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">cilo</span><span class="p">,</span><span class="n">ciup</span><span class="p">))</span>
            
            <span class="n">approx_ratio</span><span class="p">[</span><span class="n">schedule</span><span class="p">][</span><span class="n">sweep</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">random_energy</span> <span class="o">-</span> <span class="n">energy</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">random_energy</span> <span class="o">-</span> <span class="n">min_energy</span><span class="p">)</span> <span class="k">for</span> <span class="n">energy</span> <span class="ow">in</span> <span class="n">b</span><span class="p">]</span>
            <span class="n">approx_ratioci</span><span class="p">[</span><span class="n">schedule</span><span class="p">][</span><span class="n">sweep</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">((</span><span class="n">random_energy</span> <span class="o">-</span> <span class="n">element</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">random_energy</span> <span class="o">-</span> <span class="n">min_energy</span><span class="p">)</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">energy</span><span class="p">)</span> <span class="k">for</span> <span class="n">energy</span> <span class="ow">in</span> <span class="n">bcs</span><span class="p">]</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">shot</span><span class="o">*</span><span class="n">sweep</span> <span class="k">for</span> <span class="n">shot</span> <span class="ow">in</span> <span class="n">shots</span><span class="p">],</span> <span class="n">approx_ratio</span><span class="p">[</span><span class="n">schedule</span><span class="p">][</span><span class="n">sweep</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">sweep</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; sweeps&#39;</span><span class="p">)</span>
        <span class="n">approx_ratio_bestci_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">approx_ratioci</span><span class="p">[</span><span class="n">schedule</span><span class="p">][</span><span class="n">sweep</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">([</span><span class="n">shot</span><span class="o">*</span><span class="n">sweep</span> <span class="k">for</span> <span class="n">shot</span> <span class="ow">in</span> <span class="n">shots</span><span class="p">],</span><span class="n">approx_ratio_bestci_np</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">approx_ratio_bestci_np</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xscale</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mf">0.95</span><span class="p">,</span><span class="mf">1.001</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mf">1e2</span><span class="p">,</span><span class="mf">1e4</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Total number of reads (equivalent to time)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Performance ratio = </span><span class="se">\n</span><span class="s1"> &#39;</span> <span class="o">+</span> <span class="s1">&#39;(best found - random sample) / (min energy - random sample)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Simulated annealing performance ratio of Ising 42 N=100</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
          <span class="s1">&#39; with varying schedule, &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n_boot</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; bootstrap re-samples, and sweeps&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7bfa9c8bc7c0&gt;
</pre></div>
</div>
<img alt="_images/a1ac2f774be4e6fcb260cf3de9ed9bda9328124cb8507e957ea1c291dee1f7a4.png" src="_images/a1ac2f774be4e6fcb260cf3de9ed9bda9328124cb8507e957ea1c291dee1f7a4.png" />
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="Quantum%20Annealing%20via%20D-Wave.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Quantum Annealing via D-Wave</p>
      </div>
    </a>
    <a class="right-next"
       href="DWAVE%20Simulated%20Annealing.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Solving QUBOs with DWAVE Simulated Annealing</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#about-this-notebook">About this Notebook</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example">Example</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ising-model">Ising model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#problem-statement">Problem statement</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Example</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-2">Example 2</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Problem statement</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Ben Murray
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      ¬© Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>